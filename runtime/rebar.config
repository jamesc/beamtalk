%% Umbrella project layout (ADR 0007)
{project_app_dirs, ["apps/*"]}.

{erl_opts, [debug_info]}.

{deps, [
    {jsx, "~> 3.0"}
]}.

{profiles, [
    {test, [
        {erl_opts, [debug_info]},
        {eunit_opts, [
            {sys_config, ["apps/beamtalk_runtime/test/sys.config"]}
        ]}
    ]}
]}.

%% Compile test fixtures before running tests
{pre_hooks, [
    {eunit, "bash -c './apps/beamtalk_runtime/test_fixtures/compile.sh'"}
]}.

{eunit_opts, []}.

{cover_enabled, true}.
{cover_opts, [verbose]}.
%% Exclude compiled stdlib from cover â€” .beam files lack 'file' attribute
%% (compiled from Core Erlang, not .erl source)
{cover_excl_apps, [beamtalk_stdlib]}.

{plugins, [
    covertool
]}.

%% Dialyzer configuration
%% Focus on real errors, not overly-strict specs
{dialyzer, [
    {warnings, [
        error_handling     % Warn about unhandled errors
        % Disabled for now (too noisy, not bugs):
        % underspecs       % Spec is supertype of inferred type
        % unmatched_returns % Expression value is unused
    ]},
    {plt_extra_apps, [jsx, compiler]},
    {exclude_apps, [beamtalk_stdlib]}
]}.
