// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BUnit tests for the Transaction value type
//
// Run in the REPL:
//   > :load src/transaction.bt
//   > :load test/transaction_test.bt
//   > TransactionTest runAll

TestCase subclass: TransactionTest

  testDefaultAmount =>
    self assert: Transaction new amount equals: 0

  testDefaultFrom =>
    self assert: Transaction new from equals: ""

  testDefaultTo =>
    self assert: Transaction new to equals: ""

  testDefaultStatus =>
    self assert: Transaction new status equals: "pending"

  testDefaultTimestampIsNil =>
    self assert: Transaction new timestamp equals: nil

  testNewWithAmount =>
    txn := Transaction new: #{#amount => 250}
    self assert: txn amount equals: 250

  testNewWithFromAndTo =>
    txn := Transaction new: #{#from => "Alice", #to => "Bob"}
    self assert: txn from equals: "Alice"
    self assert: txn to equals: "Bob"

  testNewWithStatus =>
    txn := Transaction new: #{#status => "completed"}
    self assert: txn status equals: "completed"

  testNewWithAllFields =>
    txn := Transaction new: #{
      #amount => 500,
      #from => "Alice",
      #to => "Bob",
      #status => "completed"
    }
    self assert: txn amount equals: 500;
         assert: txn from equals: "Alice";
         assert: txn to equals: "Bob";
         assert: txn status equals: "completed"

  testTwoInstancesAreIndependent =>
    // Value types â€” no shared mutable state
    txn1 := Transaction new: #{#amount => 100, #from => "Alice"}
    txn2 := Transaction new: #{#amount => 200, #from => "Bob"}
    self assert: txn1 amount equals: 100
    self assert: txn2 amount equals: 200
