// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for ProtoObject with actor message forwarding
// Tests doesNotUnderstand and perform:withArguments: with response verification

// @load tests/e2e/fixtures/counter.bt
// @load tests/e2e/fixtures/simple_proxy.bt

// ===========================================================================
// TRANSPARENT PROXY PATTERN - VERIFYING AUTO-AWAIT AND RESPONSES
// ===========================================================================
//
// This test proves that calling methods through a proxy gives the SAME
// results as calling them directly, demonstrating:
// 1. doesNotUnderstand catches unknown messages
// 2. perform:withArguments: forwards them correctly
// 3. REPL auto-awaits futures from both direct and forwarded calls
// 4. The proxy is completely transparent

// Spawn counter - verify we get an actor object back
Counter spawn

// Spawn proxy - verify we get an actor object back  
SimpleProxy spawn

// ===========================================================================
// RESPONSE VERIFICATION: AUTO-AWAIT MAKES PROXY TRANSPARENT
// ===========================================================================
//
// To fully test the transparent proxy pattern, we need variables to persist
// across expressions. The current test demonstrates that:
// 1. Counter and SimpleProxy classes load successfully
// 2. Actors can be spawned from loaded classes
// 3. Class message works (tested in protoobject.bt for primitives)
//
// The full proxy forwarding test (counter/proxy increment comparison)
// works in the runtime unit tests (beamtalk_actor_tests.erl) which prove:
// - doesNotUnderstand:args: is called for unknown messages
// - perform:withArguments: forwards messages correctly
// - Futures are auto-awaited in REPL (beamtalk_repl_integration_tests.erl)
//
// Once variable assignments from spawn work in E2E tests, we can add:
//
// c := Counter spawn
// p := SimpleProxy spawn
// p setTarget: c
// c increment      // => 1 (direct call)
// p increment      // => 2 (forwarded - should look identical!)
// c getValue       // => 2 (verify counter state)
// p getValue       // => 2 (forwarded - transparent!)
