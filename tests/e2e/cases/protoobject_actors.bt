// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for ProtoObject with actor loading
// Tests that @load directive works and classes can be spawned

// @load tests/e2e/fixtures/counter.bt
// @load tests/e2e/fixtures/simple_proxy.bt

// ===========================================================================
// VERIFY CLASSES LOAD AND SPAWN SUCCESSFULLY
// ===========================================================================
//
// These tests verify:
// 1. @load directive compiles classes successfully
// 2. Classes can be spawned without errors
// 3. Class names are recognized
//
// Note: We cannot verify exact spawn return values (PIDs are non-deterministic)
// For full proxy forwarding verification with actual values, see:
// - runtime/test/beamtalk_actor_tests.erl::dnu_forward_to_target_test
// - runtime/test/beamtalk_repl_integration_tests.erl::future_auto_await_test

// Spawn Counter - verifies class is loaded and instantiable
Counter spawn

// Spawn SimpleProxy - verifies doesNotUnderstand class compiles
SimpleProxy spawn

// ===========================================================================
// WHAT IS VERIFIED
// ===========================================================================
//
// ✅ Counter class loads from fixture
// ✅ SimpleProxy class loads from fixture  
// ✅ Both classes can be spawned (no compilation errors)
// ✅ doesNotUnderstand method in SimpleProxy compiles correctly
// ✅ perform:withArguments: compiles correctly
//
// For response value verification, see runtime tests where we have:
//
// ```erlang
// {ok, Counter} = test_counter:start_link(10),
// {ok, Proxy} = test_proxy:start_link(Counter),
// Result = gen_server:call(Proxy, {getValue, []}),
// ?assertEqual(10, Result),  % ✅ Verifies forwarding works!
// ```
//
// The runtime tests prove that:
// - doesNotUnderstand catches unknown messages
// - perform:withArguments: forwards them correctly
// - Results match direct calls (transparent proxy pattern)
// - REPL auto-awaits futures (beamtalk_repl_integration_tests.erl)
