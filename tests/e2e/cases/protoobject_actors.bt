// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for ProtoObject with actor loading
//
// These tests verify that actor futures are automatically awaited in the REPL
// via `maybe_await_future/1` (see runtime/src/beamtalk_repl_eval.erl).
// No explicit `await` keyword is needed for synchronous REPL interaction.

// @load tests/e2e/fixtures/counter.bt

// Test actor spawn
counter := Counter spawn
// => _

// Test initial state (auto-await)
counter getValue
// => 0

// Test increment (auto-await, returns new value)
counter increment
// => 1

// Verify state persisted
counter getValue
// => 1

// Test multiple consecutive increments
counter increment
// => 2

counter increment
// => 3

// Test decrement
counter decrement
// => 2

// Final state verification
counter getValue
// => 2

// ===========================================================================
// BT-427: Object method delegation for actors
// ===========================================================================
//
// Actors inherit Object base methods (describe, inspect, hash, isNil, etc.)
// via the class hierarchy walk. These methods are NOT hardcoded in actor
// dispatch but discovered through the Object superclass.

// ---------------------------------------------------------------------------
// describe and inspect — display methods from Object
// ---------------------------------------------------------------------------

counter describe
// => _

counter inspect
// => _

// ---------------------------------------------------------------------------
// isNil and notNil — nil-testing protocol from Object
// ---------------------------------------------------------------------------

counter isNil
// => false

counter notNil
// => true

// ---------------------------------------------------------------------------
// yourself — identity method from Object
// ---------------------------------------------------------------------------

counter yourself
// => _

// ---------------------------------------------------------------------------
// hash — hashing from Object
// ---------------------------------------------------------------------------

counter hash
// => _

// ---------------------------------------------------------------------------
// respondsTo: — checks both user methods and inherited methods
// ---------------------------------------------------------------------------

// User-defined methods
counter respondsTo: #increment
// => true

counter respondsTo: #getValue
// => true

counter respondsTo: #decrement
// => true

// Nonexistent method
counter respondsTo: #nonExistent
// => false

// ---------------------------------------------------------------------------
// class — returns class name from Object
// ---------------------------------------------------------------------------

counter class
// => Counter
