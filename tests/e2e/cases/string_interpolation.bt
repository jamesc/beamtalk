// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for string interpolation in the REPL context (ADR 0023, BT-559)
//
// This file covers REPL-specific behavior only.
// Interpolation semantics (expressions, printString, unicode, etc.) are
// tested exhaustively in stdlib/test/string_interpolation_test.bt (BUnit).

// ===========================================================================
// CROSS-TURN VARIABLE PERSISTENCE IN INTERPOLATION
// ===========================================================================

// Variable assigned in one REPL turn is available for interpolation later
name := "Alice"
// => Alice

"Hello, {name}!"
// => Hello, Alice!

// Reassign and verify interpolation picks up the new value
name := "Bob"
// => Bob

"Hello, {name}!"
// => Hello, Bob!

// Two variables from separate turns both available simultaneously
greeting := "Howdy"
// => Howdy

"{greeting}, {name}!"
// => Howdy, Bob!

// ===========================================================================
// ERROR: UNDEFINED VARIABLE IN INTERPOLATION
// ===========================================================================

// Undefined variable in interpolation produces an error
"Value: {undefinedVar}"
// => ERROR: undefined

// ===========================================================================
// ERROR: EMPTY INTERPOLATION
// ===========================================================================

// Empty braces are a lexer error
"{}"
// => ERROR: empty interpolation

// ===========================================================================
// ERROR: UNTERMINATED STRING WITH INTERPOLATION
// ===========================================================================

// Unterminated string (missing closing quote)
"Hello {name
// => ERROR: "Hello {name

// ===========================================================================
// REPL DISPLAY CORRECTNESS
// ===========================================================================

// Plain string displays without extra quotes
"Hello, world!"
// => Hello, world!

// Interpolated string result displays without extra quotes
who := "World"
// => World

"Hello, {who}!"
// => Hello, World!

// Empty string
""
// =>
