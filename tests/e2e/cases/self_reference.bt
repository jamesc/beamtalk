// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for self-reference behavior (BT-172)
//
// Tests that:
// - Methods can return self
// - Self in block refers to enclosing actor, not block
// - Returned self reference is the same actor (shared state)

// @load tests/e2e/fixtures/self_ref_actor.bt

// Spawn actor
a := SelfRefActor spawn
// => _

// ===========================================================================
// METHOD RETURNING SELF
// ===========================================================================

// returnSelf returns the actor's self reference
ref := a returnSelf
// => _

// The returned reference responds to class
ref class
// => SelfRefActor

// The returned reference is the same actor (can send messages through it)
ref setValue: 99
// => _

// Verify the state changed on the original actor (same process)
a getValue
// => 99

// ===========================================================================
// SELF IN BLOCK
// ===========================================================================

// classInBlock evaluates self.class inside a block
// self in block refers to enclosing actor, not the block itself
a classInBlock
// => SelfRefActor

// ===========================================================================
// DYNAMIC DISPATCH VIA PERFORM:
// ===========================================================================

// perform: dispatches zero-arg methods dynamically
a perform: #getValue
// => 99
