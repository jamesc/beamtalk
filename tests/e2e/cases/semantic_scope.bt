// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for variable scope and resolution
//
// Tests that the compiler correctly handles variable scoping,
// block parameters, closures, and undefined variable detection.

// @load tests/e2e/fixtures/counter.bt

// --- Undefined variables produce semantic errors ---

// Bare undefined identifier triggers compile-time error
undefinedFoo
// => ERROR: Undefined variable

// Undefined variable in expression triggers error
undefinedBar + 5
// => ERROR: Undefined variable

// --- Block parameter scoping ---

// Block parameters are accessible inside the block
[:x | x + 1] value: 5
// => 6

// Nested block parameters work correctly
[:x | [:y | x + y] value: 3] value: 10
// => 13

// --- Variable scoping across expressions ---

// Variables defined in one expression are accessible in later ones (REPL session)
scopeTestVar := 100
// => 100
scopeTestVar + 50
// => 150

// Variables can be reassigned
scopeTestVar := 200
// => 200
scopeTestVar
// => 200

// --- Closure variable capture ---

// Closures capture outer variables by value
outerVal := 10
// => 10
adder := [:x | x + outerVal]
// => _
adder value: 5
// => 15

// --- Self reference in class methods ---

// self is valid in method bodies â€” actor methods use self.field
c := Counter spawn
// => _
c increment
// => 1
c increment
// => 2
c getValue
// => 2
