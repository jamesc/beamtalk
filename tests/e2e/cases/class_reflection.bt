// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for Class reflection in the REPL context
//
// This file covers REPL-specific behavior only.
// Class reflection semantics are tested exhaustively in
// stdlib/test/class_reflection_test.bt (BUnit).
//
// BT-374: Beamtalk is a workspace binding (actor) dispatched via
// persistent_term. Sends are async and return Futures, so we must
// `await` to get the actual class object.

// @load tests/e2e/fixtures/counter.bt

// ===========================================================================
// ASYNC classNamed: LOOKUP (REPL-specific: async dispatch via workspace binding)
// ===========================================================================

// Async lookup of existing class — must await the Future
stringClass := (Beamtalk classNamed: #String) await
// => String

// Workspace variable persists — name is accessible in next turn
stringClass name
// => String

// Async lookup of a loaded actor class
counterClass := (Beamtalk classNamed: #Counter) await
// => Counter

counterClass name
// => Counter

// ===========================================================================
// NIL RETURN FOR UNKNOWN CLASS (async lookup)
// ===========================================================================

// Look up a non-existent class — await resolves to nil
(Beamtalk classNamed: #NonExistentClass) await
// => nil

// ===========================================================================
// WORKSPACE VARIABLE PERSISTENCE ACROSS TURNS
// ===========================================================================

// Class object stored in workspace variable is accessible in later turns
intClass := (Beamtalk classNamed: #Integer) await
// => Integer

intClass name
// => Integer
