// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for error handling (REPL-specific)
// Pure runtime errors (badarith, does_not_understand, immutable_value, etc.)
// are tested in tests/stdlib/errors.bt for faster execution.
// This file tests errors that require REPL features.

// ===========================================================================
// UNDEFINED VARIABLES
// ===========================================================================

// Accessing undefined variable
undefinedVariable
// => ERROR: undefined

// Using undefined variable in arithmetic
undefinedVar + 5
// => ERROR: undefined

// Undefined variable in block parameter (should work - params are local)
[:undefinedParam | undefinedParam + 1] value: 5
// => 6

// ===========================================================================
// SYNTAX ERRORS
// ===========================================================================
// Note: Error message formats are implementation-specific and may change
// as the parser evolves. Tests validate that errors are caught, not the
// exact wording of error messages.

// Unmatched closing bracket
]
// => ERROR: expected expression, found ]

// Incomplete block (missing closing bracket)
[:x | x + 1
// => ERROR: Expected ']' to close block

// Invalid message selector (incomplete expression)
123 + 
// => ERROR: expected expression, found +

// ===========================================================================
// RUNTIME ERRORS
// ===========================================================================

// Wrong number of block arguments (too few)
[:x :y | x + y] value: 5
// => ERROR: badarity

// Wrong number of block arguments (too many)
[:x | x + 1] value: 5 value: 10
// => ERROR: badarity

// ===========================================================================
// PRIMITIVE TYPE INSTANTIATION ERRORS (BT-422)
// ===========================================================================
// Primitive types are backed by native BEAM values, not maps.
// Calling `new` on them should raise an instantiation_error.

Dictionary new
// => ERROR: instantiation_error

Integer new
// => ERROR: instantiation_error

String new
// => ERROR: instantiation_error

List new
// => ERROR: instantiation_error

CompiledMethod new
// => ERROR: instantiation_error

Float new
// => ERROR: instantiation_error

Symbol new
// => ERROR: instantiation_error

Tuple new
// => ERROR: instantiation_error

True new
// => ERROR: instantiation_error

False new
// => ERROR: instantiation_error
