// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for error handling (REPL-specific)
// Pure runtime errors (badarith, does_not_understand, immutable_value,
// instantiation_error, etc.) are tested in tests/stdlib/errors.bt.
// This file tests errors that require REPL features:
// - Undefined variables (REPL workspace binding resolution)
// - Syntax errors (REPL incremental parsing)

// ===========================================================================
// UNDEFINED VARIABLES
// ===========================================================================

// Accessing undefined variable
undefinedVariable
// => ERROR: undefined

// Using undefined variable in arithmetic
undefinedVar + 5
// => ERROR: undefined

// Undefined variable in block parameter (should work - params are local)
[:undefinedParam | undefinedParam + 1] value: 5
// => 6

// ===========================================================================
// SYNTAX ERRORS
// ===========================================================================
// Note: Error message formats are implementation-specific and may change
// as the parser evolves. Tests validate that errors are caught, not the
// exact wording of error messages.

// Unmatched closing bracket
]
// => ERROR: expected expression, found ]

// Incomplete block (missing closing bracket)
[:x | x + 1
// => ERROR: Expected ']' to close block

// Invalid message selector (incomplete expression)
123 + 
// => ERROR: expected expression, found +

// ===========================================================================
// RUNTIME ERRORS (need REPL substring matching for non-beamtalk errors)
// ===========================================================================

// Wrong number of block arguments (too few)
[:x :y | x + y] value: 5
// => ERROR: Wrong number of arguments: block expects 2 but was called with 1

// Wrong number of block arguments (too many)
[:x | x + 1] value: 5 value: 10
// => ERROR: Wrong number of arguments: block expects 1 but was called with 2
