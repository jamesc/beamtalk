// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-754: Non-local return (^) inside block arguments in Object subclass methods.
//
// A ^ inside a block (e.g. ifTrue: [^"early"]) must cause an early return from
// the enclosing method, not just from the block.
//
// @load tests/e2e/fixtures/nlr_return_test.bt
// @load tests/e2e/fixtures/nlr_foo.bt
// @load tests/e2e/fixtures/nlr_bar.bt
// @load tests/e2e/fixtures/nlr_baz.bt
// @load tests/e2e/fixtures/nlr_skipper.bt
// @load tests/e2e/fixtures/nlr_doubler.bt
// @load tests/e2e/fixtures/nlr_on_do.bt

// === ifTrue: with non-local return ===

NlrReturnTest new test: #()
// => empty

NlrReturnTest new test: #(1)
// => not empty

// === ifTrue:ifFalse: with non-local returns in both branches ===

NlrFoo new classify: 5
// => positive

NlrFoo new classify: -1
// => non-positive

NlrFoo new classify: 0
// => non-positive

// === ifFalse: with non-local return ===

NlrBar new check: #()
// => empty

NlrBar new check: #(1)
// => not empty

// === Top-level ^ still works (regression guard) ===

NlrBaz new double: 5
// => 10

// === Early return skips later expressions ===

NlrSkipper new test: #()
// => early

NlrSkipper new test: #(1, 2, 3)
// => middle

// === Non-local return with computed value ===

NlrDoubler new test: 5
// => 10

NlrDoubler new test: -1
// => 0

// === NLR throw propagates through on:do: (not swallowed) ===

NlrOnDo new test: #()
// => early

NlrOnDo new test: #(1)
// => not early
