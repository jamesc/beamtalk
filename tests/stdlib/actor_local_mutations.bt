// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-598: Test local variable mutation in actor method blocks
// Tests that local variables can be mutated inside control flow blocks
// (do:, inject:into:, whileTrue:, timesRepeat:, to:do:) within actor methods.

// @load tests/e2e/fixtures/local_mutation_actor.bt
// @load tests/e2e/fixtures/field_mutation_accumulator.bt

// === do: with pure local mutation ===
a := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(a sumWithDo: #(1, 2, 3, 4, 5)) await
// => 15

// === inject:into: with local mutation ===
b := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(b sumWithInject: #(10, 20, 30)) await
// => #{#count => 3, #result => 60}

// === timesRepeat: with local mutation ===
c := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(c countToN: 5) await
// => 5

// === to:do: with local mutation ===
d := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(d sumRange: 5) await
// => 15

// === whileTrue: with local mutation ===
e := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(e countDownFrom: 3) await
// => 3

// === Mixed local + field mutation in do: ===
f := LocalMutationActor spawn
// => #Actor<LocalMutationActor,_>

(f processWithTracking: #(5, 10, 15)) await
// => #{#localCount => 3, #log => 30}

// === Mixed local + field mutation (FieldMutationAccumulator) ===
g := FieldMutationAccumulator spawn
// => #Actor<FieldMutationAccumulator,_>

(g processWithLocal: #(10, 20, 30)) await
// => #{#localSum => 3, #sum => 60}
