// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Tests for variable scope and resolution
// Migrated from E2E: cross-expression variable resolution (BT-459)
//
// Tests block parameters, closures, variable persistence, and actor self.
// NOTE: Undefined variable ERROR: tests stay in E2E (require semantic analysis).

// @load tests/e2e/fixtures/counter.bt

// --- Block parameter scoping ---

// Block parameters are accessible inside the block
[:x | x + 1] value: 5
// => 6

// Nested block parameters work correctly
[:x | [:y | x + y] value: 3] value: 10
// => 13

// --- Variable scoping across expressions ---

// Variables defined in one expression are accessible in later ones
scopeTestVar := 100
// => 100
scopeTestVar + 50
// => 150

// Variables can be reassigned
scopeTestVar := 200
// => 200
scopeTestVar
// => 200

// --- Closure variable capture ---

// Closures capture outer variables
outerVal := 10
// => 10
adder := [:x | x + outerVal]
// => _
adder value: 5
// => 15

// --- Self reference in class methods ---

// self is valid in method bodies â€” actor methods use self.field
c := Counter spawn
// => _
c increment await
// => 1
c increment await
// => 2
c getValue await
// => 2
