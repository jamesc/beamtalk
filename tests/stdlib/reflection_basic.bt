// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Test basic reflection API (BT-97)
// Migrated from E2E: cross-expression variable resolution (BT-459)
// @load tests/e2e/fixtures/counter.bt

// Create counter instance
c := Counter spawn
// => _

// Test class reflection
c class
// => Counter

// Test respondsTo: with symbol literal
c respondsTo: #increment
// => true

// Test respondsTo: with non-existent method
c respondsTo: #nonExistent
// => false

// Test instVarNames
(c instVarNames) await
// => ["value"]

// Test instVarAt: - read field value
(c instVarAt: #value) await
// => 0

// Increment to change state
c increment await
// => 1

// Test instVarAt: after state change
(c instVarAt: #value) await
// => 1

// Test instVarAt:put: - set field value
(c instVarAt: #value put: 42) await
// => 42

// Verify field was set
c getValue await
// => 42

// Test perform: - dynamic dispatch (zero-arity method)
(c perform: #getValue) await
// => 42

// Test perform: with another method
(c perform: #increment) await
// => 43

// Verify increment worked via getValue
c getValue await
// => 43

// BT-359: instVarAt:put: on value types raises immutable_value error
42 instVarAt: #x put: 99
// => ERROR: immutable_value

// BT-359: instVarAt: on value types raises immutable_value error
42 instVarAt: #x
// => ERROR: immutable_value

// BT-359: instVarAt:put: on string also errors
'hello' instVarAt: #x put: 'world'
// => ERROR: immutable_value
