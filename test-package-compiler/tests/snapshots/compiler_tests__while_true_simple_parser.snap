---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
AST:
Module {
    classes: [],
    expressions: [
        Assignment {
            target: Identifier(
                Identifier {
                    name: "test",
                    span: Span {
                        start: 125,
                        end: 129,
                    },
                },
            ),
            value: Block(
                Block {
                    parameters: [],
                    body: [
                        Assignment {
                            target: Identifier(
                                Identifier {
                                    name: "count",
                                    span: Span {
                                        start: 139,
                                        end: 144,
                                    },
                                },
                            ),
                            value: Literal(
                                Integer(
                                    0,
                                ),
                                Span {
                                    start: 148,
                                    end: 149,
                                },
                            ),
                            span: Span {
                                start: 139,
                                end: 149,
                            },
                        },
                        MessageSend {
                            receiver: Block(
                                Block {
                                    parameters: [],
                                    body: [
                                        MessageSend {
                                            receiver: Identifier(
                                                Identifier {
                                                    name: "count",
                                                    span: Span {
                                                        start: 156,
                                                        end: 161,
                                                    },
                                                },
                                            ),
                                            selector: Binary(
                                                "<",
                                            ),
                                            arguments: [
                                                Literal(
                                                    Integer(
                                                        3,
                                                    ),
                                                    Span {
                                                        start: 164,
                                                        end: 165,
                                                    },
                                                ),
                                            ],
                                            span: Span {
                                                start: 156,
                                                end: 165,
                                            },
                                        },
                                    ],
                                    span: Span {
                                        start: 155,
                                        end: 166,
                                    },
                                },
                            ),
                            selector: Keyword(
                                [
                                    KeywordPart {
                                        keyword: "whileTrue:",
                                        span: Span {
                                            start: 167,
                                            end: 177,
                                        },
                                    },
                                ],
                            ),
                            arguments: [
                                Block(
                                    Block {
                                        parameters: [],
                                        body: [
                                            Assignment {
                                                target: Identifier(
                                                    Identifier {
                                                        name: "count",
                                                        span: Span {
                                                            start: 179,
                                                            end: 184,
                                                        },
                                                    },
                                                ),
                                                value: MessageSend {
                                                    receiver: Identifier(
                                                        Identifier {
                                                            name: "count",
                                                            span: Span {
                                                                start: 188,
                                                                end: 193,
                                                            },
                                                        },
                                                    ),
                                                    selector: Binary(
                                                        "+",
                                                    ),
                                                    arguments: [
                                                        Literal(
                                                            Integer(
                                                                1,
                                                            ),
                                                            Span {
                                                                start: 196,
                                                                end: 197,
                                                            },
                                                        ),
                                                    ],
                                                    span: Span {
                                                        start: 188,
                                                        end: 197,
                                                    },
                                                },
                                                span: Span {
                                                    start: 179,
                                                    end: 197,
                                                },
                                            },
                                        ],
                                        span: Span {
                                            start: 178,
                                            end: 198,
                                        },
                                    },
                                ),
                            ],
                            span: Span {
                                start: 155,
                                end: 198,
                            },
                        },
                        Return {
                            value: Identifier(
                                Identifier {
                                    name: "count",
                                    span: Span {
                                        start: 205,
                                        end: 210,
                                    },
                                },
                            ),
                            span: Span {
                                start: 204,
                                end: 210,
                            },
                        },
                    ],
                    span: Span {
                        start: 133,
                        end: 212,
                    },
                },
            ),
            span: Span {
                start: 125,
                end: 212,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "testLocal",
                    span: Span {
                        start: 250,
                        end: 259,
                    },
                },
            ),
            value: Block(
                Block {
                    parameters: [],
                    body: [
                        Assignment {
                            target: Identifier(
                                Identifier {
                                    name: "x",
                                    span: Span {
                                        start: 269,
                                        end: 270,
                                    },
                                },
                            ),
                            value: Literal(
                                Integer(
                                    0,
                                ),
                                Span {
                                    start: 274,
                                    end: 275,
                                },
                            ),
                            span: Span {
                                start: 269,
                                end: 275,
                            },
                        },
                        MessageSend {
                            receiver: Block(
                                Block {
                                    parameters: [],
                                    body: [
                                        MessageSend {
                                            receiver: Identifier(
                                                Identifier {
                                                    name: "x",
                                                    span: Span {
                                                        start: 282,
                                                        end: 283,
                                                    },
                                                },
                                            ),
                                            selector: Binary(
                                                "<",
                                            ),
                                            arguments: [
                                                Literal(
                                                    Integer(
                                                        5,
                                                    ),
                                                    Span {
                                                        start: 286,
                                                        end: 287,
                                                    },
                                                ),
                                            ],
                                            span: Span {
                                                start: 282,
                                                end: 287,
                                            },
                                        },
                                    ],
                                    span: Span {
                                        start: 281,
                                        end: 288,
                                    },
                                },
                            ),
                            selector: Keyword(
                                [
                                    KeywordPart {
                                        keyword: "whileTrue:",
                                        span: Span {
                                            start: 289,
                                            end: 299,
                                        },
                                    },
                                ],
                            ),
                            arguments: [
                                Block(
                                    Block {
                                        parameters: [],
                                        body: [
                                            Assignment {
                                                target: Identifier(
                                                    Identifier {
                                                        name: "x",
                                                        span: Span {
                                                            start: 301,
                                                            end: 302,
                                                        },
                                                    },
                                                ),
                                                value: MessageSend {
                                                    receiver: Identifier(
                                                        Identifier {
                                                            name: "x",
                                                            span: Span {
                                                                start: 306,
                                                                end: 307,
                                                            },
                                                        },
                                                    ),
                                                    selector: Binary(
                                                        "+",
                                                    ),
                                                    arguments: [
                                                        Literal(
                                                            Integer(
                                                                1,
                                                            ),
                                                            Span {
                                                                start: 310,
                                                                end: 311,
                                                            },
                                                        ),
                                                    ],
                                                    span: Span {
                                                        start: 306,
                                                        end: 311,
                                                    },
                                                },
                                                span: Span {
                                                    start: 301,
                                                    end: 311,
                                                },
                                            },
                                        ],
                                        span: Span {
                                            start: 300,
                                            end: 312,
                                        },
                                    },
                                ),
                            ],
                            span: Span {
                                start: 281,
                                end: 312,
                            },
                        },
                        Return {
                            value: Identifier(
                                Identifier {
                                    name: "x",
                                    span: Span {
                                        start: 319,
                                        end: 320,
                                    },
                                },
                            ),
                            span: Span {
                                start: 318,
                                end: 320,
                            },
                        },
                    ],
                    span: Span {
                        start: 263,
                        end: 322,
                    },
                },
            ),
            span: Span {
                start: 250,
                end: 322,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "testBlockParam",
                    span: Span {
                        start: 383,
                        end: 397,
                    },
                },
            ),
            value: Block(
                Block {
                    parameters: [],
                    body: [
                        Assignment {
                            target: Identifier(
                                Identifier {
                                    name: "result",
                                    span: Span {
                                        start: 407,
                                        end: 413,
                                    },
                                },
                            ),
                            value: MessageSend {
                                receiver: Block(
                                    Block {
                                        parameters: [
                                            BlockParameter {
                                                name: "x",
                                                span: Span {
                                                    start: 419,
                                                    end: 420,
                                                },
                                            },
                                        ],
                                        body: [
                                            MessageSend {
                                                receiver: Block(
                                                    Block {
                                                        parameters: [],
                                                        body: [
                                                            MessageSend {
                                                                receiver: Identifier(
                                                                    Identifier {
                                                                        name: "x",
                                                                        span: Span {
                                                                            start: 433,
                                                                            end: 434,
                                                                        },
                                                                    },
                                                                ),
                                                                selector: Binary(
                                                                    "<",
                                                                ),
                                                                arguments: [
                                                                    Literal(
                                                                        Integer(
                                                                            5,
                                                                        ),
                                                                        Span {
                                                                            start: 437,
                                                                            end: 438,
                                                                        },
                                                                    ),
                                                                ],
                                                                span: Span {
                                                                    start: 433,
                                                                    end: 438,
                                                                },
                                                            },
                                                        ],
                                                        span: Span {
                                                            start: 432,
                                                            end: 439,
                                                        },
                                                    },
                                                ),
                                                selector: Keyword(
                                                    [
                                                        KeywordPart {
                                                            keyword: "whileTrue:",
                                                            span: Span {
                                                                start: 440,
                                                                end: 450,
                                                            },
                                                        },
                                                    ],
                                                ),
                                                arguments: [
                                                    Block(
                                                        Block {
                                                            parameters: [],
                                                            body: [
                                                                Assignment {
                                                                    target: Identifier(
                                                                        Identifier {
                                                                            name: "x",
                                                                            span: Span {
                                                                                start: 452,
                                                                                end: 453,
                                                                            },
                                                                        },
                                                                    ),
                                                                    value: MessageSend {
                                                                        receiver: Identifier(
                                                                            Identifier {
                                                                                name: "x",
                                                                                span: Span {
                                                                                    start: 457,
                                                                                    end: 458,
                                                                                },
                                                                            },
                                                                        ),
                                                                        selector: Binary(
                                                                            "+",
                                                                        ),
                                                                        arguments: [
                                                                            Literal(
                                                                                Integer(
                                                                                    1,
                                                                                ),
                                                                                Span {
                                                                                    start: 461,
                                                                                    end: 462,
                                                                                },
                                                                            ),
                                                                        ],
                                                                        span: Span {
                                                                            start: 457,
                                                                            end: 462,
                                                                        },
                                                                    },
                                                                    span: Span {
                                                                        start: 452,
                                                                        end: 462,
                                                                    },
                                                                },
                                                            ],
                                                            span: Span {
                                                                start: 451,
                                                                end: 463,
                                                            },
                                                        },
                                                    ),
                                                ],
                                                span: Span {
                                                    start: 432,
                                                    end: 463,
                                                },
                                            },
                                            Identifier(
                                                Identifier {
                                                    name: "x",
                                                    span: Span {
                                                        start: 473,
                                                        end: 474,
                                                    },
                                                },
                                            ),
                                        ],
                                        span: Span {
                                            start: 417,
                                            end: 480,
                                        },
                                    },
                                ),
                                selector: Keyword(
                                    [
                                        KeywordPart {
                                            keyword: "value:",
                                            span: Span {
                                                start: 481,
                                                end: 487,
                                            },
                                        },
                                    ],
                                ),
                                arguments: [
                                    Literal(
                                        Integer(
                                            0,
                                        ),
                                        Span {
                                            start: 488,
                                            end: 489,
                                        },
                                    ),
                                ],
                                span: Span {
                                    start: 417,
                                    end: 489,
                                },
                            },
                            span: Span {
                                start: 407,
                                end: 489,
                            },
                        },
                        Return {
                            value: Identifier(
                                Identifier {
                                    name: "result",
                                    span: Span {
                                        start: 496,
                                        end: 502,
                                    },
                                },
                            ),
                            span: Span {
                                start: 495,
                                end: 502,
                            },
                        },
                    ],
                    span: Span {
                        start: 401,
                        end: 504,
                    },
                },
            ),
            span: Span {
                start: 383,
                end: 504,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "testBlockParamWhileFalse",
                    span: Span {
                        start: 579,
                        end: 603,
                    },
                },
            ),
            value: Block(
                Block {
                    parameters: [],
                    body: [
                        Assignment {
                            target: Identifier(
                                Identifier {
                                    name: "result",
                                    span: Span {
                                        start: 613,
                                        end: 619,
                                    },
                                },
                            ),
                            value: Block(
                                Block {
                                    parameters: [
                                        BlockParameter {
                                            name: "n",
                                            span: Span {
                                                start: 625,
                                                end: 626,
                                            },
                                        },
                                    ],
                                    body: [
                                        Block(
                                            Block {
                                                parameters: [],
                                                body: [
                                                    Identifier(
                                                        Identifier {
                                                            name: "n",
                                                            span: Span {
                                                                start: 638,
                                                                end: 639,
                                                            },
                                                        },
                                                    ),
                                                ],
                                                span: Span {
                                                    start: 637,
                                                    end: 638,
                                                },
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 623,
                                        end: 624,
                                    },
                                },
                            ),
                            span: Span {
                                start: 613,
                                end: 624,
                            },
                        },
                    ],
                    span: Span {
                        start: 607,
                        end: 608,
                    },
                },
            ),
            span: Span {
                start: 579,
                end: 608,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found =",
            span: Span {
                start: 640,
                end: 641,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 643,
                    end: 644,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileFalse:",
                        span: Span {
                            start: 645,
                            end: 656,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "n",
                                        span: Span {
                                            start: 658,
                                            end: 659,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "n",
                                            span: Span {
                                                start: 663,
                                                end: 664,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "-",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 667,
                                                end: 668,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 663,
                                        end: 668,
                                    },
                                },
                                span: Span {
                                    start: 658,
                                    end: 668,
                                },
                            },
                        ],
                        span: Span {
                            start: 657,
                            end: 669,
                        },
                    },
                ),
            ],
            span: Span {
                start: 643,
                end: 669,
            },
        },
        Identifier(
            Identifier {
                name: "n",
                span: Span {
                    start: 679,
                    end: 680,
                },
            },
        ),
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 685,
                    end: 686,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "value:",
                        span: Span {
                            start: 687,
                            end: 693,
                        },
                    },
                ],
            ),
            arguments: [
                Literal(
                    Integer(
                        5,
                    ),
                    Span {
                        start: 694,
                        end: 695,
                    },
                ),
            ],
            span: Span {
                start: 685,
                end: 695,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "result",
                    span: Span {
                        start: 702,
                        end: 708,
                    },
                },
            ),
            span: Span {
                start: 701,
                end: 708,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 709,
                end: 710,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 794,
                end: 795,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 838,
                end: 839,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "counter",
                    span: Span {
                        start: 846,
                        end: 853,
                    },
                },
            ),
            span: Span {
                start: 845,
                end: 853,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 854,
                end: 855,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1004,
                end: 1005,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 1021,
                    end: 1022,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "value:",
                        span: Span {
                            start: 1023,
                            end: 1029,
                        },
                    },
                ],
            ),
            arguments: [
                Literal(
                    Integer(
                        5,
                    ),
                    Span {
                        start: 1030,
                        end: 1031,
                    },
                ),
            ],
            span: Span {
                start: 1021,
                end: 1031,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "result",
                    span: Span {
                        start: 1038,
                        end: 1044,
                    },
                },
            ),
            span: Span {
                start: 1037,
                end: 1044,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1045,
                end: 1046,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1115,
                end: 1116,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1158,
                end: 1159,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "total",
                    span: Span {
                        start: 1166,
                        end: 1171,
                    },
                },
            ),
            span: Span {
                start: 1165,
                end: 1171,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1172,
                end: 1173,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1290,
                end: 1291,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1332,
                end: 1333,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 1351,
                    end: 1352,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "value:",
                        span: Span {
                            start: 1353,
                            end: 1359,
                        },
                    },
                ],
            ),
            arguments: [
                Literal(
                    Integer(
                        1,
                    ),
                    Span {
                        start: 1360,
                        end: 1361,
                    },
                ),
            ],
            span: Span {
                start: 1351,
                end: 1361,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "result",
                    span: Span {
                        start: 1368,
                        end: 1374,
                    },
                },
            ),
            span: Span {
                start: 1367,
                end: 1374,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1375,
                end: 1376,
            },
        },
    ],
    span: Span {
        start: 125,
        end: 1377,
    },
    leading_comments: [
        Comment {
            content: "// Copyright 2026 James Casey",
            span: Span {
                start: 125,
                end: 129,
            },
            kind: Line,
        },
        Comment {
            content: "// SPDX-License-Identifier: Apache-2.0",
            span: Span {
                start: 125,
                end: 129,
            },
            kind: Line,
        },
        Comment {
            content: "// Simple whileTrue test with local variable mutation",
            span: Span {
                start: 125,
                end: 129,
            },
            kind: Line,
        },
    ],
}

Diagnostics:
Diagnostic { severity: Error, message: "Expected ']' to close block", span: Span { start: 640, end: 641 }, hint: None }
Diagnostic { severity: Error, message: "Expected ']' to close block", span: Span { start: 640, end: 641 }, hint: None }
Diagnostic { severity: Error, message: "Expected ']' to close block", span: Span { start: 640, end: 641 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =", span: Span { start: 640, end: 641 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 643, end: 644 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 685, end: 686 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 709, end: 710 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 794, end: 795 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 838, end: 839 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 854, end: 855 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1004, end: 1005 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1021, end: 1022 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1045, end: 1046 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1115, end: 1116 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1158, end: 1159 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1172, end: 1173 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1290, end: 1291 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1332, end: 1333 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1351, end: 1352 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1375, end: 1376 }, hint: None }
