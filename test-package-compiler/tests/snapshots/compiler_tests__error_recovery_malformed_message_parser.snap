---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
AST:
Module {
    classes: [],
    method_definitions: [],
    expressions: [
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Copyright 2026 James Casey",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "SPDX-License-Identifier: Apache-2.0",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Test error recovery: malformed message sends",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                    Comment {
                        content: "Parser should handle incomplete messages",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Incomplete keyword message",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: MessageSend {
                receiver: Identifier(
                    Identifier {
                        name: "dict",
                        span: Span {
                            start: 193,
                            end: 197,
                        },
                    },
                ),
                selector: Keyword(
                    [
                        KeywordPart {
                            keyword: "at:",
                            span: Span {
                                start: 198,
                                end: 201,
                            },
                        },
                    ],
                ),
                arguments: [
                    Identifier(
                        Identifier {
                            name: "key",
                            span: Span {
                                start: 202,
                                end: 205,
                            },
                        },
                    ),
                ],
                is_cast: false,
                span: Span {
                    start: 193,
                    end: 205,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Missing keyword part",
                        span: Span {
                            start: 231,
                            end: 236,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: MessageSend {
                receiver: Identifier(
                    Identifier {
                        name: "array",
                        span: Span {
                            start: 231,
                            end: 236,
                        },
                    },
                ),
                selector: Keyword(
                    [
                        KeywordPart {
                            keyword: "at:",
                            span: Span {
                                start: 237,
                                end: 240,
                            },
                        },
                    ],
                ),
                arguments: [
                    MessageSend {
                        receiver: Identifier(
                            Identifier {
                                name: "index",
                                span: Span {
                                    start: 241,
                                    end: 246,
                                },
                            },
                        ),
                        selector: Unary(
                            "put",
                        ),
                        arguments: [],
                        is_cast: false,
                        span: Span {
                            start: 241,
                            end: 250,
                        },
                    },
                ],
                is_cast: false,
                span: Span {
                    start: 231,
                    end: 250,
                },
            },
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Extra keyword without argument",
                        span: Span {
                            start: 286,
                            end: 292,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: MessageSend {
                receiver: Identifier(
                    Identifier {
                        name: "object",
                        span: Span {
                            start: 286,
                            end: 292,
                        },
                    },
                ),
                selector: Keyword(
                    [
                        KeywordPart {
                            keyword: "foo:",
                            span: Span {
                                start: 293,
                                end: 297,
                            },
                        },
                        KeywordPart {
                            keyword: "bar:",
                            span: Span {
                                start: 300,
                                end: 304,
                            },
                        },
                    ],
                ),
                arguments: [
                    Literal(
                        Integer(
                            1,
                        ),
                        Span {
                            start: 298,
                            end: 299,
                        },
                    ),
                    Error {
                        message: "Unexpected token: expected expression, found at:",
                        span: Span {
                            start: 334,
                            end: 337,
                        },
                    },
                ],
                is_cast: false,
                span: Span {
                    start: 286,
                    end: 337,
                },
            },
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Literal(
                Integer(
                    42,
                ),
                Span {
                    start: 338,
                    end: 340,
                },
            ),
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Valid code after error",
                        span: Span {
                            start: 368,
                            end: 374,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "result",
                        span: Span {
                            start: 368,
                            end: 374,
                        },
                    },
                ),
                value: MessageSend {
                    receiver: Literal(
                        Integer(
                            5,
                        ),
                        Span {
                            start: 378,
                            end: 379,
                        },
                    ),
                    selector: Binary(
                        "+",
                    ),
                    arguments: [
                        Literal(
                            Integer(
                                5,
                            ),
                            Span {
                                start: 382,
                                end: 383,
                            },
                        ),
                    ],
                    is_cast: false,
                    span: Span {
                        start: 378,
                        end: 383,
                    },
                },
                span: Span {
                    start: 368,
                    end: 383,
                },
            },
            preceding_blank_line: true,
        },
    ],
    span: Span {
        start: 193,
        end: 383,
    },
    file_leading_comments: [],
    file_trailing_comments: [],
}

Diagnostics:
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found at:", span: Span { start: 334, end: 337 }, hint: None, category: None }
