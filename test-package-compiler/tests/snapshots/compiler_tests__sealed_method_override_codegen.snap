---
source: test-package-compiler/tests/compiler_tests.rs
expression: core_erlang
---
module 'sealed_method_override' ['new'/0, 'new'/1, 'frozen'/1, 'dispatch'/3, 'has_method'/1, 'superclass'/0]
  attributes []

'new'/0 = fun () ->
    ~{'$beamtalk_class' => 'Parent'}~


'new'/1 = fun (InitArgs) ->
    let DefaultState = call 'sealed_method_override':'new'() in
    call 'maps':'merge'(DefaultState, InitArgs)


'frozen'/1= fun (Self) ->
42

'dispatch'/3 = fun (Selector, Args, Self) ->
    case Selector of
        <'class'> when 'true' ->
            'Parent'
        <'respondsTo'> when 'true' ->
            case Args of
                <[RtSelector | _]> when 'true' -> call 'sealed_method_override':'has_method'(RtSelector)
                <_> when 'true' -> 'false'
            end
        <'instVarNames'> when 'true' ->
            []
        <'instVarAt'> when 'true' ->
            'nil'
        <'instVarAt:put:'> when 'true' ->
            let <ImmErr0> = call 'beamtalk_error':'new'('immutable_primitive', 'Parent') in
            let <ImmErr1> = call 'beamtalk_error':'with_selector'(ImmErr0, 'instVarAt:put:') in
            let <ImmErr2> = call 'beamtalk_error':'with_hint'(ImmErr1, #{#<80>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<114>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<110>(8,1,'integer',['unsigned'|['big']]),#<116>(8,1,'integer',['unsigned'|['big']]),#<115>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<114>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<105>(8,1,'integer',['unsigned'|['big']]),#<109>(8,1,'integer',['unsigned'|['big']]),#<109>(8,1,'integer',['unsigned'|['big']]),#<117>(8,1,'integer',['unsigned'|['big']]),#<116>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<98>(8,1,'integer',['unsigned'|['big']]),#<108>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<46>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<85>(8,1,'integer',['unsigned'|['big']]),#<115>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<115>(8,1,'integer',['unsigned'|['big']]),#<115>(8,1,'integer',['unsigned'|['big']]),#<105>(8,1,'integer',['unsigned'|['big']]),#<103>(8,1,'integer',['unsigned'|['big']]),#<110>(8,1,'integer',['unsigned'|['big']]),#<109>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<110>(8,1,'integer',['unsigned'|['big']]),#<116>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<40>(8,1,'integer',['unsigned'|['big']]),#<120>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<58>(8,1,'integer',['unsigned'|['big']]),#<61>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<110>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<119>(8,1,'integer',['unsigned'|['big']]),#<86>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<108>(8,1,'integer',['unsigned'|['big']]),#<117>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<41>(8,1,'integer',['unsigned'|['big']]),#<32>(8,1,'integer',['unsigned'|['big']]),#<105>(8,1,'integer',['unsigned'|['big']]),#<110>(8,1,'integer',['unsigned'|['big']]),#<115>(8,1,'integer',['unsigned'|['big']]),#<116>(8,1,'integer',['unsigned'|['big']]),#<101>(8,1,'integer',['unsigned'|['big']]),#<97>(8,1,'integer',['unsigned'|['big']]),#<100>(8,1,'integer',['unsigned'|['big']]),#<46>(8,1,'integer',['unsigned'|['big']])}#) in
            call 'erlang':'error'(ImmErr2)
        <'perform'> when 'true' ->
            let <PerfSel> = call 'erlang':'hd'(Args) in
            call 'sealed_method_override':'dispatch'(PerfSel, [], Self)
        <'perform:withArguments:'> when 'true' ->
            let <PwaSel> = call 'erlang':'hd'(Args) in
            let <PwaArgs> = call 'erlang':'hd'(call 'erlang':'tl'(Args)) in
            call 'sealed_method_override':'dispatch'(PwaSel, PwaArgs, Self)
        <'frozen'> when 'true' ->
            call 'sealed_method_override':'frozen'(Self)
        <_Other> when 'true' ->
            case call 'beamtalk_extensions':'lookup'('Parent', Selector) of
                <{'ok', ExtFun, _ExtOwner}> when 'true' ->
                    apply ExtFun(Args, Self)
                <'not_found'> when 'true' ->
                    call 'bt_stdlib_object':'dispatch'(Selector, Args, Self)
            end
    end


'has_method'/1 = fun (Selector) ->
    case call 'lists':'member'(Selector, ['class', 'respondsTo', 'instVarNames', 'instVarAt', 'instVarAt:put:', 'perform', 'perform:withArguments:', 'frozen']) of
        <'true'> when 'true' -> 'true'
        <'false'> when 'true' ->
            case call 'beamtalk_extensions':'has'('Parent', Selector) of
                <'true'> when 'true' -> 'true'
                <'false'> when 'true' -> call 'bt_stdlib_object':'has_method'(Selector)
            end
    end


'superclass'/0 = fun () -> 'Object'

end
