---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
Token { kind: Identifier("outerBlock"), span: Span { start: 158, end: 168 }, leading_trivia: [LineComment("// Copyright 2026 James Casey"), Whitespace("\n"), LineComment("// SPDX-License-Identifier: Apache-2.0"), Whitespace("\n\n"), LineComment("// Test nested block closures"), Whitespace("\n"), LineComment("// Blocks inside other blocks"), Whitespace("\n\n"), LineComment("// Block returning a block"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 169, end: 171 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 172, end: 173 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: LeftBracket, span: Span { start: 173, end: 174 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Colon, span: Span { start: 174, end: 175 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("x"), span: Span { start: 175, end: 176 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Pipe, span: Span { start: 177, end: 178 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("x"), span: Span { start: 179, end: 180 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("+"), span: Span { start: 181, end: 182 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("1"), span: Span { start: 183, end: 184 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 184, end: 185 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 185, end: 186 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("innerBlock"), span: Span { start: 187, end: 197 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 198, end: 200 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("outerBlock"), span: Span { start: 201, end: 211 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("value"), span: Span { start: 212, end: 217 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("result"), span: Span { start: 218, end: 224 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 225, end: 227 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("innerBlock"), span: Span { start: 228, end: 238 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("value:"), span: Span { start: 239, end: 245 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("5"), span: Span { start: 246, end: 247 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("deeplyNested"), span: Span { start: 273, end: 285 }, leading_trivia: [Whitespace("\n\n"), LineComment("// Deeply nested blocks"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 286, end: 288 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 289, end: 290 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: LeftBracket, span: Span { start: 290, end: 291 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: LeftBracket, span: Span { start: 291, end: 292 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Integer("42"), span: Span { start: 292, end: 294 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 294, end: 295 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 295, end: 296 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 296, end: 297 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("blockWithNested"), span: Span { start: 334, end: 349 }, leading_trivia: [Whitespace("\n\n"), LineComment("// Block with nested block in body"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 350, end: 352 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 353, end: 354 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Colon, span: Span { start: 354, end: 355 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("x"), span: Span { start: 355, end: 356 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Pipe, span: Span { start: 357, end: 358 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("inner"), span: Span { start: 364, end: 369 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 370, end: 372 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 373, end: 374 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Colon, span: Span { start: 374, end: 375 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("y"), span: Span { start: 375, end: 376 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Pipe, span: Span { start: 377, end: 378 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("y"), span: Span { start: 379, end: 380 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("*"), span: Span { start: 381, end: 382 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("2"), span: Span { start: 383, end: 384 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 384, end: 385 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("inner"), span: Span { start: 390, end: 395 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("value:"), span: Span { start: 396, end: 402 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("x"), span: Span { start: 403, end: 404 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 405, end: 406 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [] }
Token { kind: Identifier("processor"), span: Span { start: 447, end: 456 }, leading_trivia: [Whitespace("\n\n"), LineComment("// Multiple nested blocks in arguments"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("forEach:"), span: Span { start: 457, end: 465 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("items"), span: Span { start: 466, end: 471 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("with:"), span: Span { start: 472, end: 477 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 478, end: 479 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Colon, span: Span { start: 479, end: 480 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("item"), span: Span { start: 480, end: 484 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Pipe, span: Span { start: 485, end: 486 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("mapper"), span: Span { start: 491, end: 497 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 498, end: 500 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 501, end: 502 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Colon, span: Span { start: 502, end: 503 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("val"), span: Span { start: 503, end: 506 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Pipe, span: Span { start: 507, end: 508 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("val"), span: Span { start: 509, end: 512 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("+"), span: Span { start: 513, end: 514 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("1"), span: Span { start: 515, end: 516 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 516, end: 517 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("mapper"), span: Span { start: 522, end: 528 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("value:"), span: Span { start: 529, end: 535 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("item"), span: Span { start: 536, end: 540 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 541, end: 542 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [] }
Token { kind: Eof, span: Span { start: 543, end: 543 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [] }
