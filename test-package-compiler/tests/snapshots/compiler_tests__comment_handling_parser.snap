---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
AST:
Module {
    classes: [],
    method_definitions: [],
    expressions: [
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Copyright 2026 James Casey",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "SPDX-License-Identifier: Apache-2.0",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Test comment handling",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                    Comment {
                        content: "Comments should be preserved as trivia",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Single line comment",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: Some(
                    Comment {
                        content: "inline comment",
                        span: Span {
                            start: 166,
                            end: 167,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                ),
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "x",
                        span: Span {
                            start: 161,
                            end: 162,
                        },
                    },
                ),
                value: Literal(
                    Integer(
                        5,
                    ),
                    Span {
                        start: 166,
                        end: 167,
                    },
                ),
                span: Span {
                    start: 161,
                    end: 167,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Multiple comments",
                        span: Span {
                            start: 244,
                            end: 245,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                    Comment {
                        content: "Comment line 1",
                        span: Span {
                            start: 244,
                            end: 245,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Comment line 2",
                        span: Span {
                            start: 244,
                            end: 245,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "y",
                        span: Span {
                            start: 244,
                            end: 245,
                        },
                    },
                ),
                value: Literal(
                    Integer(
                        10,
                    ),
                    Span {
                        start: 249,
                        end: 251,
                    },
                ),
                span: Span {
                    start: 244,
                    end: 251,
                },
            },
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Comment between expressions",
                        span: Span {
                            start: 284,
                            end: 285,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "a",
                        span: Span {
                            start: 284,
                            end: 285,
                        },
                    },
                ),
                value: Literal(
                    Integer(
                        1,
                    ),
                    Span {
                        start: 289,
                        end: 290,
                    },
                ),
                span: Span {
                    start: 284,
                    end: 290,
                },
            },
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Middle comment",
                        span: Span {
                            start: 309,
                            end: 310,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "b",
                        span: Span {
                            start: 309,
                            end: 310,
                        },
                    },
                ),
                value: Literal(
                    Integer(
                        2,
                    ),
                    Span {
                        start: 314,
                        end: 315,
                    },
                ),
                span: Span {
                    start: 309,
                    end: 315,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Comment in message send",
                        span: Span {
                            start: 344,
                            end: 350,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: Some(
                    Comment {
                        content: "comment here",
                        span: Span {
                            start: 344,
                            end: 350,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                ),
            },
            expression: Identifier(
                Identifier {
                    name: "object",
                    span: Span {
                        start: 344,
                        end: 350,
                    },
                },
            ),
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: Some(
                    Comment {
                        content: "and here",
                        span: Span {
                            start: 380,
                            end: 385,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                ),
            },
            expression: MessageSend {
                receiver: Error {
                    message: "Unexpected token: expected expression, found message:",
                    span: Span {
                        start: 371,
                        end: 379,
                    },
                },
                selector: Unary(
                    "value",
                ),
                arguments: [],
                is_cast: false,
                span: Span {
                    start: 371,
                    end: 385,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Block with comments",
                        span: Span {
                            start: 422,
                            end: 427,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "block",
                        span: Span {
                            start: 422,
                            end: 427,
                        },
                    },
                ),
                value: Block(
                    Block {
                        parameters: [],
                        body: [
                            ExpressionStatement {
                                comments: CommentAttachment {
                                    leading: [
                                        Comment {
                                            content: "Inside block",
                                            span: Span {
                                                start: 457,
                                                end: 459,
                                            },
                                            kind: Line,
                                            preceding_blank_line: false,
                                        },
                                    ],
                                    trailing: None,
                                },
                                expression: Literal(
                                    Integer(
                                        42,
                                    ),
                                    Span {
                                        start: 457,
                                        end: 459,
                                    },
                                ),
                                preceding_blank_line: false,
                            },
                        ],
                        span: Span {
                            start: 431,
                            end: 461,
                        },
                    },
                ),
                span: Span {
                    start: 422,
                    end: 461,
                },
            },
            preceding_blank_line: true,
        },
    ],
    span: Span {
        start: 161,
        end: 461,
    },
    file_leading_comments: [],
    file_trailing_comments: [
        Comment {
            content: "Commented out code (still comments)",
            span: Span {
                start: 526,
                end: 526,
            },
            kind: Line,
            preceding_blank_line: true,
        },
        Comment {
            content: "x := 999",
            span: Span {
                start: 526,
                end: 526,
            },
            kind: Line,
            preceding_blank_line: false,
        },
        Comment {
            content: "y := 888",
            span: Span {
                start: 526,
                end: 526,
            },
            kind: Line,
            preceding_blank_line: false,
        },
    ],
}

Diagnostics:
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found message:", span: Span { start: 371, end: 379 }, hint: None, category: None }
