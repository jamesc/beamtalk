---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
AST:
Module {
    classes: [],
    method_definitions: [],
    expressions: [
        Assignment {
            target: Identifier(
                Identifier {
                    name: "count",
                    span: Span {
                        start: 376,
                        end: 381,
                    },
                },
            ),
            value: Literal(
                Integer(
                    0,
                ),
                Span {
                    start: 385,
                    end: 386,
                },
            ),
            span: Span {
                start: 376,
                end: 386,
            },
        },
        MessageSend {
            receiver: Block(
                Block {
                    parameters: [],
                    body: [
                        MessageSend {
                            receiver: Identifier(
                                Identifier {
                                    name: "count",
                                    span: Span {
                                        start: 389,
                                        end: 394,
                                    },
                                },
                            ),
                            selector: Binary(
                                "<",
                            ),
                            arguments: [
                                Literal(
                                    Integer(
                                        3,
                                    ),
                                    Span {
                                        start: 397,
                                        end: 398,
                                    },
                                ),
                            ],
                            span: Span {
                                start: 389,
                                end: 398,
                            },
                        },
                    ],
                    span: Span {
                        start: 388,
                        end: 399,
                    },
                },
            ),
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 400,
                            end: 410,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "count",
                                        span: Span {
                                            start: 412,
                                            end: 417,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "count",
                                            span: Span {
                                                start: 421,
                                                end: 426,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 429,
                                                end: 430,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 421,
                                        end: 430,
                                    },
                                },
                                span: Span {
                                    start: 412,
                                    end: 430,
                                },
                            },
                        ],
                        span: Span {
                            start: 411,
                            end: 431,
                        },
                    },
                ),
            ],
            span: Span {
                start: 388,
                end: 431,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "count2",
                    span: Span {
                        start: 485,
                        end: 491,
                    },
                },
            ),
            value: Literal(
                Integer(
                    10,
                ),
                Span {
                    start: 495,
                    end: 497,
                },
            ),
            span: Span {
                start: 485,
                end: 497,
            },
        },
        Block(
            Block {
                parameters: [],
                body: [
                    Identifier(
                        Identifier {
                            name: "count2",
                            span: Span {
                                start: 500,
                                end: 506,
                            },
                        },
                    ),
                ],
                span: Span {
                    start: 499,
                    end: 500,
                },
            },
        ),
        Error {
            message: "Unexpected token: expected expression, found =",
            span: Span {
                start: 507,
                end: 508,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 510,
                    end: 511,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileFalse:",
                        span: Span {
                            start: 512,
                            end: 523,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "count2",
                                        span: Span {
                                            start: 525,
                                            end: 531,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "count2",
                                            span: Span {
                                                start: 535,
                                                end: 541,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "-",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 544,
                                                end: 545,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 535,
                                        end: 545,
                                    },
                                },
                                span: Span {
                                    start: 525,
                                    end: 545,
                                },
                            },
                        ],
                        span: Span {
                            start: 524,
                            end: 546,
                        },
                    },
                ),
            ],
            span: Span {
                start: 510,
                end: 546,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "sum",
                    span: Span {
                        start: 615,
                        end: 618,
                    },
                },
            ),
            value: Literal(
                Integer(
                    0,
                ),
                Span {
                    start: 622,
                    end: 623,
                },
            ),
            span: Span {
                start: 615,
                end: 623,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "product",
                    span: Span {
                        start: 625,
                        end: 632,
                    },
                },
            ),
            value: Literal(
                Integer(
                    1,
                ),
                Span {
                    start: 636,
                    end: 637,
                },
            ),
            span: Span {
                start: 625,
                end: 637,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "i",
                    span: Span {
                        start: 639,
                        end: 640,
                    },
                },
            ),
            value: Literal(
                Integer(
                    1,
                ),
                Span {
                    start: 644,
                    end: 645,
                },
            ),
            span: Span {
                start: 639,
                end: 645,
            },
        },
        MessageSend {
            receiver: Block(
                Block {
                    parameters: [],
                    body: [
                        MessageSend {
                            receiver: Identifier(
                                Identifier {
                                    name: "i",
                                    span: Span {
                                        start: 648,
                                        end: 649,
                                    },
                                },
                            ),
                            selector: Binary(
                                "<=",
                            ),
                            arguments: [
                                Literal(
                                    Integer(
                                        3,
                                    ),
                                    Span {
                                        start: 653,
                                        end: 654,
                                    },
                                ),
                            ],
                            span: Span {
                                start: 648,
                                end: 654,
                            },
                        },
                    ],
                    span: Span {
                        start: 647,
                        end: 655,
                    },
                },
            ),
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 656,
                            end: 666,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "sum",
                                        span: Span {
                                            start: 673,
                                            end: 676,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "sum",
                                            span: Span {
                                                start: 680,
                                                end: 683,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Identifier(
                                            Identifier {
                                                name: "i",
                                                span: Span {
                                                    start: 686,
                                                    end: 687,
                                                },
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 680,
                                        end: 687,
                                    },
                                },
                                span: Span {
                                    start: 673,
                                    end: 687,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "product",
                                        span: Span {
                                            start: 693,
                                            end: 700,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "product",
                                            span: Span {
                                                start: 704,
                                                end: 711,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "*",
                                    ),
                                    arguments: [
                                        Identifier(
                                            Identifier {
                                                name: "i",
                                                span: Span {
                                                    start: 714,
                                                    end: 715,
                                                },
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 704,
                                        end: 715,
                                    },
                                },
                                span: Span {
                                    start: 693,
                                    end: 715,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "i",
                                        span: Span {
                                            start: 721,
                                            end: 722,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "i",
                                            span: Span {
                                                start: 726,
                                                end: 727,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 730,
                                                end: 731,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 726,
                                        end: 731,
                                    },
                                },
                                span: Span {
                                    start: 721,
                                    end: 731,
                                },
                            },
                        ],
                        span: Span {
                            start: 667,
                            end: 733,
                        },
                    },
                ),
            ],
            span: Span {
                start: 647,
                end: 733,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "counter",
                    span: Span {
                        start: 948,
                        end: 955,
                    },
                },
            ),
            value: Literal(
                Integer(
                    0,
                ),
                Span {
                    start: 959,
                    end: 960,
                },
            ),
            span: Span {
                start: 948,
                end: 960,
            },
        },
        MessageSend {
            receiver: Literal(
                Integer(
                    5,
                ),
                Span {
                    start: 962,
                    end: 963,
                },
            ),
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "timesRepeat:",
                        span: Span {
                            start: 964,
                            end: 976,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "counter",
                                        span: Span {
                                            start: 978,
                                            end: 985,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "counter",
                                            span: Span {
                                                start: 989,
                                                end: 996,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 999,
                                                end: 1000,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 989,
                                        end: 1000,
                                    },
                                },
                                span: Span {
                                    start: 978,
                                    end: 1000,
                                },
                            },
                        ],
                        span: Span {
                            start: 977,
                            end: 1001,
                        },
                    },
                ),
            ],
            span: Span {
                start: 962,
                end: 1001,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "total",
                    span: Span {
                        start: 1066,
                        end: 1071,
                    },
                },
            ),
            value: Literal(
                Integer(
                    0,
                ),
                Span {
                    start: 1075,
                    end: 1076,
                },
            ),
            span: Span {
                start: 1066,
                end: 1076,
            },
        },
        MessageSend {
            receiver: Literal(
                Integer(
                    1,
                ),
                Span {
                    start: 1078,
                    end: 1079,
                },
            ),
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "to:",
                        span: Span {
                            start: 1080,
                            end: 1083,
                        },
                    },
                    KeywordPart {
                        keyword: "do:",
                        span: Span {
                            start: 1087,
                            end: 1090,
                        },
                    },
                ],
            ),
            arguments: [
                Literal(
                    Integer(
                        10,
                    ),
                    Span {
                        start: 1084,
                        end: 1086,
                    },
                ),
                Block(
                    Block {
                        parameters: [
                            BlockParameter {
                                name: "n",
                                span: Span {
                                    start: 1093,
                                    end: 1094,
                                },
                            },
                        ],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "total",
                                        span: Span {
                                            start: 1097,
                                            end: 1102,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "total",
                                            span: Span {
                                                start: 1106,
                                                end: 1111,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Identifier(
                                            Identifier {
                                                name: "n",
                                                span: Span {
                                                    start: 1114,
                                                    end: 1115,
                                                },
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 1106,
                                        end: 1115,
                                    },
                                },
                                span: Span {
                                    start: 1097,
                                    end: 1115,
                                },
                            },
                        ],
                        span: Span {
                            start: 1091,
                            end: 1116,
                        },
                    },
                ),
            ],
            span: Span {
                start: 1078,
                end: 1116,
            },
        },
        Assignment {
            target: Identifier(
                Identifier {
                    name: "numbers",
                    span: Span {
                        start: 1314,
                        end: 1321,
                    },
                },
            ),
            value: Error {
                message: "Unexpected '#': expected '#(' for a list, '#{' for a map, or '#name'/'#\\'quoted\\'' for a symbol",
                span: Span {
                    start: 1325,
                    end: 1326,
                },
            },
            span: Span {
                start: 1314,
                end: 1326,
            },
        },
        Block(
            Block {
                parameters: [],
                body: [
                    Literal(
                        Integer(
                            1,
                        ),
                        Span {
                            start: 1327,
                            end: 1328,
                        },
                    ),
                ],
                span: Span {
                    start: 1326,
                    end: 1327,
                },
            },
        ),
        Error {
            message: "Unexpected token: expected expression, found ,",
            span: Span {
                start: 1328,
                end: 1329,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1340,
                end: 1341,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1356,
                end: 1357,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1400,
                end: 1401,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1505,
                end: 1506,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 1591,
                    end: 1592,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "ifFalse:",
                        span: Span {
                            start: 1593,
                            end: 1601,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Literal(
                                Integer(
                                    0,
                                ),
                                Span {
                                    start: 1603,
                                    end: 1604,
                                },
                            ),
                        ],
                        span: Span {
                            start: 1602,
                            end: 1605,
                        },
                    },
                ),
            ],
            span: Span {
                start: 1591,
                end: 1605,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found )",
            span: Span {
                start: 1605,
                end: 1606,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1618,
                end: 1619,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1718,
                end: 1719,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1783,
                end: 1784,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1801,
                end: 1802,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 1900,
                end: 1901,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 1986,
                end: 1987,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 2001,
                end: 2002,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 2210,
                end: 2211,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 2225,
                end: 2226,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 2233,
                end: 2234,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 2242,
                    end: 2243,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 2244,
                            end: 2254,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "y",
                                        span: Span {
                                            start: 2261,
                                            end: 2262,
                                        },
                                    },
                                ),
                                value: Literal(
                                    Integer(
                                        1,
                                    ),
                                    Span {
                                        start: 2266,
                                        end: 2267,
                                    },
                                ),
                                span: Span {
                                    start: 2261,
                                    end: 2267,
                                },
                            },
                            MessageSend {
                                receiver: Block(
                                    Block {
                                        parameters: [],
                                        body: [
                                            MessageSend {
                                                receiver: Identifier(
                                                    Identifier {
                                                        name: "y",
                                                        span: Span {
                                                            start: 2274,
                                                            end: 2275,
                                                        },
                                                    },
                                                ),
                                                selector: Binary(
                                                    "<=",
                                                ),
                                                arguments: [
                                                    Literal(
                                                        Integer(
                                                            2,
                                                        ),
                                                        Span {
                                                            start: 2279,
                                                            end: 2280,
                                                        },
                                                    ),
                                                ],
                                                span: Span {
                                                    start: 2274,
                                                    end: 2280,
                                                },
                                            },
                                        ],
                                        span: Span {
                                            start: 2273,
                                            end: 2281,
                                        },
                                    },
                                ),
                                selector: Keyword(
                                    [
                                        KeywordPart {
                                            keyword: "whileTrue:",
                                            span: Span {
                                                start: 2282,
                                                end: 2292,
                                            },
                                        },
                                    ],
                                ),
                                arguments: [
                                    Block(
                                        Block {
                                            parameters: [],
                                            body: [
                                                Assignment {
                                                    target: Identifier(
                                                        Identifier {
                                                            name: "innerSum",
                                                            span: Span {
                                                                start: 2303,
                                                                end: 2311,
                                                            },
                                                        },
                                                    ),
                                                    value: MessageSend {
                                                        receiver: Identifier(
                                                            Identifier {
                                                                name: "innerSum",
                                                                span: Span {
                                                                    start: 2315,
                                                                    end: 2323,
                                                                },
                                                            },
                                                        ),
                                                        selector: Binary(
                                                            "+",
                                                        ),
                                                        arguments: [
                                                            Literal(
                                                                Integer(
                                                                    1,
                                                                ),
                                                                Span {
                                                                    start: 2326,
                                                                    end: 2327,
                                                                },
                                                            ),
                                                        ],
                                                        span: Span {
                                                            start: 2315,
                                                            end: 2327,
                                                        },
                                                    },
                                                    span: Span {
                                                        start: 2303,
                                                        end: 2327,
                                                    },
                                                },
                                                Assignment {
                                                    target: Identifier(
                                                        Identifier {
                                                            name: "y",
                                                            span: Span {
                                                                start: 2337,
                                                                end: 2338,
                                                            },
                                                        },
                                                    ),
                                                    value: MessageSend {
                                                        receiver: Identifier(
                                                            Identifier {
                                                                name: "y",
                                                                span: Span {
                                                                    start: 2342,
                                                                    end: 2343,
                                                                },
                                                            },
                                                        ),
                                                        selector: Binary(
                                                            "+",
                                                        ),
                                                        arguments: [
                                                            Literal(
                                                                Integer(
                                                                    1,
                                                                ),
                                                                Span {
                                                                    start: 2346,
                                                                    end: 2347,
                                                                },
                                                            ),
                                                        ],
                                                        span: Span {
                                                            start: 2342,
                                                            end: 2347,
                                                        },
                                                    },
                                                    span: Span {
                                                        start: 2337,
                                                        end: 2347,
                                                    },
                                                },
                                            ],
                                            span: Span {
                                                start: 2293,
                                                end: 2353,
                                            },
                                        },
                                    ),
                                ],
                                span: Span {
                                    start: 2273,
                                    end: 2353,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "outerSum",
                                        span: Span {
                                            start: 2359,
                                            end: 2367,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "outerSum",
                                            span: Span {
                                                start: 2371,
                                                end: 2379,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Identifier(
                                            Identifier {
                                                name: "innerSum",
                                                span: Span {
                                                    start: 2382,
                                                    end: 2390,
                                                },
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 2371,
                                        end: 2390,
                                    },
                                },
                                span: Span {
                                    start: 2359,
                                    end: 2390,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "x",
                                        span: Span {
                                            start: 2396,
                                            end: 2397,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "x",
                                            span: Span {
                                                start: 2401,
                                                end: 2402,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 2405,
                                                end: 2406,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 2401,
                                        end: 2406,
                                    },
                                },
                                span: Span {
                                    start: 2396,
                                    end: 2406,
                                },
                            },
                        ],
                        span: Span {
                            start: 2255,
                            end: 2408,
                        },
                    },
                ),
            ],
            span: Span {
                start: 2242,
                end: 2408,
            },
        },
        Error {
            message: "Invalid assignment target",
            span: Span {
                start: 2588,
                end: 2595,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 2636,
                end: 2637,
            },
        },
        MessageSend {
            receiver: MessageSend {
                receiver: Error {
                    message: "Unexpected token: expected expression, found .",
                    span: Span {
                        start: 2673,
                        end: 2674,
                    },
                },
                selector: Unary(
                    "value",
                ),
                arguments: [],
                span: Span {
                    start: 2673,
                    end: 2679,
                },
            },
            selector: Binary(
                "<",
            ),
            arguments: [
                Literal(
                    Integer(
                        10,
                    ),
                    Span {
                        start: 2682,
                        end: 2684,
                    },
                ),
            ],
            span: Span {
                start: 2673,
                end: 2684,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 2684,
                    end: 2685,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 2686,
                            end: 2696,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: FieldAccess {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "self",
                                            span: Span {
                                                start: 2711,
                                                end: 2715,
                                            },
                                        },
                                    ),
                                    field: Identifier {
                                        name: "value",
                                        span: Span {
                                            start: 2716,
                                            end: 2721,
                                        },
                                    },
                                    span: Span {
                                        start: 2711,
                                        end: 2721,
                                    },
                                },
                                value: MessageSend {
                                    receiver: FieldAccess {
                                        receiver: Identifier(
                                            Identifier {
                                                name: "self",
                                                span: Span {
                                                    start: 2725,
                                                    end: 2729,
                                                },
                                            },
                                        ),
                                        field: Identifier {
                                            name: "value",
                                            span: Span {
                                                start: 2730,
                                                end: 2735,
                                            },
                                        },
                                        span: Span {
                                            start: 2725,
                                            end: 2735,
                                        },
                                    },
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 2738,
                                                end: 2739,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 2725,
                                        end: 2739,
                                    },
                                },
                                span: Span {
                                    start: 2711,
                                    end: 2739,
                                },
                            },
                        ],
                        span: Span {
                            start: 2697,
                            end: 2749,
                        },
                    },
                ),
            ],
            span: Span {
                start: 2684,
                end: 2749,
            },
        },
        Return {
            value: FieldAccess {
                receiver: Identifier(
                    Identifier {
                        name: "self",
                        span: Span {
                            start: 2760,
                            end: 2764,
                        },
                    },
                ),
                field: Identifier {
                    name: "value",
                    span: Span {
                        start: 2765,
                        end: 2770,
                    },
                },
                span: Span {
                    start: 2760,
                    end: 2770,
                },
            },
            span: Span {
                start: 2759,
                end: 2770,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found incrementBy:",
                span: Span {
                    start: 2781,
                    end: 2793,
                },
            },
            selector: Unary(
                "amount",
            ),
            arguments: [],
            span: Span {
                start: 2781,
                end: 2800,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found =>",
            span: Span {
                start: 2801,
                end: 2803,
            },
        },
        Error {
            message: "Invalid assignment target",
            span: Span {
                start: 2850,
                end: 2856,
            },
        },
        MessageSend {
            receiver: MessageSend {
                receiver: Error {
                    message: "Unexpected token: expected expression, found .",
                    span: Span {
                        start: 2864,
                        end: 2865,
                    },
                },
                selector: Unary(
                    "value",
                ),
                arguments: [],
                span: Span {
                    start: 2864,
                    end: 2870,
                },
            },
            selector: Binary(
                "+",
            ),
            arguments: [
                Literal(
                    Integer(
                        1,
                    ),
                    Span {
                        start: 2873,
                        end: 2874,
                    },
                ),
            ],
            span: Span {
                start: 2864,
                end: 2874,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 2883,
                end: 2884,
            },
        },
        Return {
            value: FieldAccess {
                receiver: Identifier(
                    Identifier {
                        name: "self",
                        span: Span {
                            start: 2895,
                            end: 2899,
                        },
                    },
                ),
                field: Identifier {
                    name: "value",
                    span: Span {
                        start: 2900,
                        end: 2905,
                    },
                },
                span: Span {
                    start: 2895,
                    end: 2905,
                },
            },
            span: Span {
                start: 2894,
                end: 2905,
            },
        },
        Identifier(
            Identifier {
                name: "multiplyFieldWithLoop",
                span: Span {
                    start: 2916,
                    end: 2937,
                },
            },
        ),
        Error {
            message: "Unexpected token: expected expression, found =>",
            span: Span {
                start: 2938,
                end: 2940,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 2960,
                end: 2961,
            },
        },
        MessageSend {
            receiver: MessageSend {
                receiver: Error {
                    message: "Unexpected token: expected expression, found .",
                    span: Span {
                        start: 2974,
                        end: 2975,
                    },
                },
                selector: Unary(
                    "value",
                ),
                arguments: [],
                span: Span {
                    start: 2974,
                    end: 2980,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "timesRepeat:",
                        span: Span {
                            start: 2981,
                            end: 2993,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "result",
                                        span: Span {
                                            start: 3008,
                                            end: 3014,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "result",
                                            span: Span {
                                                start: 3018,
                                                end: 3024,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "*",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                2,
                                            ),
                                            Span {
                                                start: 3027,
                                                end: 3028,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 3018,
                                        end: 3028,
                                    },
                                },
                                span: Span {
                                    start: 3008,
                                    end: 3028,
                                },
                            },
                        ],
                        span: Span {
                            start: 2994,
                            end: 3038,
                        },
                    },
                ),
            ],
            span: Span {
                start: 2974,
                end: 3038,
            },
        },
        Assignment {
            target: FieldAccess {
                receiver: Identifier(
                    Identifier {
                        name: "self",
                        span: Span {
                            start: 3048,
                            end: 3052,
                        },
                    },
                ),
                field: Identifier {
                    name: "result",
                    span: Span {
                        start: 3053,
                        end: 3059,
                    },
                },
                span: Span {
                    start: 3048,
                    end: 3059,
                },
            },
            value: Identifier(
                Identifier {
                    name: "result",
                    span: Span {
                        start: 3063,
                        end: 3069,
                    },
                },
            ),
            span: Span {
                start: 3048,
                end: 3069,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "result",
                    span: Span {
                        start: 3080,
                        end: 3086,
                    },
                },
            ),
            span: Span {
                start: 3079,
                end: 3086,
            },
        },
        Identifier(
            Identifier {
                name: "complexMutation",
                span: Span {
                    start: 3097,
                    end: 3112,
                },
            },
        ),
        Error {
            message: "Unexpected token: expected expression, found =>",
            span: Span {
                start: 3113,
                end: 3115,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3177,
                end: 3178,
            },
        },
        MessageSend {
            receiver: MessageSend {
                receiver: Error {
                    message: "Unexpected token: expected expression, found .",
                    span: Span {
                        start: 3192,
                        end: 3193,
                    },
                },
                selector: Unary(
                    "value",
                ),
                arguments: [],
                span: Span {
                    start: 3192,
                    end: 3198,
                },
            },
            selector: Binary(
                "<",
            ),
            arguments: [
                Literal(
                    Integer(
                        5,
                    ),
                    Span {
                        start: 3201,
                        end: 3202,
                    },
                ),
            ],
            span: Span {
                start: 3192,
                end: 3202,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 3202,
                    end: 3203,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 3204,
                            end: 3214,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: FieldAccess {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "self",
                                            span: Span {
                                                start: 3229,
                                                end: 3233,
                                            },
                                        },
                                    ),
                                    field: Identifier {
                                        name: "value",
                                        span: Span {
                                            start: 3234,
                                            end: 3239,
                                        },
                                    },
                                    span: Span {
                                        start: 3229,
                                        end: 3239,
                                    },
                                },
                                value: MessageSend {
                                    receiver: FieldAccess {
                                        receiver: Identifier(
                                            Identifier {
                                                name: "self",
                                                span: Span {
                                                    start: 3243,
                                                    end: 3247,
                                                },
                                            },
                                        ),
                                        field: Identifier {
                                            name: "value",
                                            span: Span {
                                                start: 3248,
                                                end: 3253,
                                            },
                                        },
                                        span: Span {
                                            start: 3243,
                                            end: 3253,
                                        },
                                    },
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 3256,
                                                end: 3257,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 3243,
                                        end: 3257,
                                    },
                                },
                                span: Span {
                                    start: 3229,
                                    end: 3257,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "temp",
                                        span: Span {
                                            start: 3271,
                                            end: 3275,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "temp",
                                            span: Span {
                                                start: 3279,
                                                end: 3283,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        FieldAccess {
                                            receiver: Identifier(
                                                Identifier {
                                                    name: "self",
                                                    span: Span {
                                                        start: 3286,
                                                        end: 3290,
                                                    },
                                                },
                                            ),
                                            field: Identifier {
                                                name: "value",
                                                span: Span {
                                                    start: 3291,
                                                    end: 3296,
                                                },
                                            },
                                            span: Span {
                                                start: 3286,
                                                end: 3296,
                                            },
                                        },
                                    ],
                                    span: Span {
                                        start: 3279,
                                        end: 3296,
                                    },
                                },
                                span: Span {
                                    start: 3271,
                                    end: 3296,
                                },
                            },
                        ],
                        span: Span {
                            start: 3215,
                            end: 3306,
                        },
                    },
                ),
            ],
            span: Span {
                start: 3202,
                end: 3306,
            },
        },
        Return {
            value: Identifier(
                Identifier {
                    name: "temp",
                    span: Span {
                        start: 3317,
                        end: 3321,
                    },
                },
            ),
            span: Span {
                start: 3316,
                end: 3321,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found state:",
                span: Span {
                    start: 3332,
                    end: 3338,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "result:",
                        span: Span {
                            start: 3339,
                            end: 3346,
                        },
                    },
                ],
            ),
            arguments: [
                ClassReference {
                    name: Identifier {
                        name: "Integer",
                        span: Span {
                            start: 3347,
                            end: 3354,
                        },
                    },
                    span: Span {
                        start: 3347,
                        end: 3354,
                    },
                },
            ],
            span: Span {
                start: 3332,
                end: 3354,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found =",
            span: Span {
                start: 3355,
                end: 3356,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3358,
                end: 3359,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3361,
                end: 3362,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3547,
                end: 3548,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found ]",
            span: Span {
                start: 3591,
                end: 3592,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3678,
                end: 3679,
            },
        },
        Error {
            message: "Unexpected token: expected expression, found .",
            span: Span {
                start: 3686,
                end: 3687,
            },
        },
        MessageSend {
            receiver: Error {
                message: "Unexpected token: expected expression, found ]",
                span: Span {
                    start: 3694,
                    end: 3695,
                },
            },
            selector: Keyword(
                [
                    KeywordPart {
                        keyword: "whileTrue:",
                        span: Span {
                            start: 3696,
                            end: 3706,
                        },
                    },
                ],
            ),
            arguments: [
                Block(
                    Block {
                        parameters: [],
                        body: [
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "a",
                                        span: Span {
                                            start: 3713,
                                            end: 3714,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "a",
                                            span: Span {
                                                start: 3718,
                                                end: 3719,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "+",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                1,
                                            ),
                                            Span {
                                                start: 3722,
                                                end: 3723,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 3718,
                                        end: 3723,
                                    },
                                },
                                span: Span {
                                    start: 3713,
                                    end: 3723,
                                },
                            },
                            Assignment {
                                target: Identifier(
                                    Identifier {
                                        name: "b",
                                        span: Span {
                                            start: 3729,
                                            end: 3730,
                                        },
                                    },
                                ),
                                value: MessageSend {
                                    receiver: Identifier(
                                        Identifier {
                                            name: "b",
                                            span: Span {
                                                start: 3734,
                                                end: 3735,
                                            },
                                        },
                                    ),
                                    selector: Binary(
                                        "*",
                                    ),
                                    arguments: [
                                        Literal(
                                            Integer(
                                                2,
                                            ),
                                            Span {
                                                start: 3738,
                                                end: 3739,
                                            },
                                        ),
                                    ],
                                    span: Span {
                                        start: 3734,
                                        end: 3739,
                                    },
                                },
                                span: Span {
                                    start: 3729,
                                    end: 3739,
                                },
                            },
                        ],
                        span: Span {
                            start: 3707,
                            end: 3741,
                        },
                    },
                ),
            ],
            span: Span {
                start: 3694,
                end: 3741,
            },
        },
    ],
    span: Span {
        start: 376,
        end: 3742,
    },
    leading_comments: [
        Comment {
            content: "// Copyright 2026 James Casey",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// SPDX-License-Identifier: Apache-2.0",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// Test control flow constructs with variable and field mutations",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// Per BT-90 design: literal blocks in control flow positions can mutate",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// ========================================",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// Local Variable Mutations",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// ========================================",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
        Comment {
            content: "// Simple whileTrue with local variable mutation",
            span: Span {
                start: 376,
                end: 381,
            },
            kind: Line,
        },
    ],
}

Diagnostics:
Diagnostic { severity: Error, message: "Expected ']' to close block", span: Span { start: 507, end: 508 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =", span: Span { start: 507, end: 508 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 510, end: 511 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected '#': expected '#(' for a list, '#{' for a map, or '#name'/'#\\'quoted\\'' for a symbol", span: Span { start: 1325, end: 1326 }, hint: None }
Diagnostic { severity: Error, message: "Expected ']' to close block", span: Span { start: 1328, end: 1329 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ,", span: Span { start: 1328, end: 1329 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1340, end: 1341 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1356, end: 1357 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1400, end: 1401 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1505, end: 1506 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1591, end: 1592 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found )", span: Span { start: 1605, end: 1606 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1618, end: 1619 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1718, end: 1719 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1783, end: 1784 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1801, end: 1802 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 1900, end: 1901 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 1986, end: 1987 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 2001, end: 2002 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2210, end: 2211 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2225, end: 2226 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2233, end: 2234 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 2242, end: 2243 }, hint: None }
Diagnostic { severity: Error, message: "Assignment target must be an identifier or field access", span: Span { start: 2588, end: 2595 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2636, end: 2637 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2673, end: 2674 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 2684, end: 2685 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found incrementBy:", span: Span { start: 2781, end: 2793 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =>", span: Span { start: 2801, end: 2803 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2850, end: 2851 }, hint: None }
Diagnostic { severity: Error, message: "Assignment target must be an identifier or field access", span: Span { start: 2850, end: 2856 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2864, end: 2865 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 2883, end: 2884 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =>", span: Span { start: 2938, end: 2940 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2960, end: 2961 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 2974, end: 2975 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =>", span: Span { start: 3113, end: 3115 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3177, end: 3178 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3192, end: 3193 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 3202, end: 3203 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found state:", span: Span { start: 3332, end: 3338 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found =", span: Span { start: 3355, end: 3356 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3358, end: 3359 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3361, end: 3362 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3547, end: 3548 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 3591, end: 3592 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3678, end: 3679 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found .", span: Span { start: 3686, end: 3687 }, hint: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 3694, end: 3695 }, hint: None }
