---
source: test-package-compiler/tests/compiler_tests.rs
assertion_line: 50
expression: output
---
Token { kind: Identifier("Counter"), span: Span { start: 258, end: 265 }, leading_trivia: [LineComment("// Copyright 2026 James Casey"), Whitespace("\n"), LineComment("// SPDX-License-Identifier: Apache-2.0"), Whitespace("\n\n"), LineComment("// Test error cases: stored closures should NOT allow mutations"), Whitespace("\n"), LineComment("// Per BT-90 design: only literal blocks in control flow positions can mutate"), Whitespace("\n\n"), LineComment("// ERROR: Field Assignment in Stored Closure"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 266, end: 268 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("class"), span: Span { start: 269, end: 274 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 275, end: 276 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Keyword("state:"), span: Span { start: 281, end: 287 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("value:"), span: Span { start: 288, end: 294 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("Integer"), span: Span { start: 295, end: 302 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("="), span: Span { start: 303, end: 304 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("0"), span: Span { start: 305, end: 306 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 306, end: 307 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("badBlock"), span: Span { start: 375, end: 383 }, leading_trivia: [Whitespace("\n    \n    "), LineComment("// ERROR: Cannot store a block that assigns to fields"), Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: FatArrow, span: Span { start: 384, end: 386 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("myBlock"), span: Span { start: 395, end: 402 }, leading_trivia: [Whitespace("\n        ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 403, end: 405 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 406, end: 407 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("self"), span: Span { start: 407, end: 411 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 411, end: 412 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("value"), span: Span { start: 412, end: 417 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 418, end: 420 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("self"), span: Span { start: 421, end: 425 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 425, end: 426 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("value"), span: Span { start: 426, end: 431 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("+"), span: Span { start: 432, end: 433 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("1"), span: Span { start: 434, end: 435 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 435, end: 436 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 436, end: 437 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Caret, span: Span { start: 446, end: 447 }, leading_trivia: [Whitespace("\n        ")], trailing_trivia: [] }
Token { kind: Identifier("myBlock"), span: Span { start: 447, end: 454 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 454, end: 455 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 456, end: 457 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 457, end: 458 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("testLocalMutationWarning"), span: Span { start: 514, end: 538 }, leading_trivia: [Whitespace("\n\n"), LineComment("// WARNING: Local Variable Mutation in Stored Closure"), Whitespace("\n")], trailing_trivia: [Whitespace(" ")] }
Token { kind: FatArrow, span: Span { start: 539, end: 541 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("count"), span: Span { start: 546, end: 551 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 552, end: 554 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("0"), span: Span { start: 555, end: 556 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 556, end: 557 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("myBlock"), span: Span { start: 562, end: 569 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 570, end: 572 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: LeftBracket, span: Span { start: 573, end: 574 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Identifier("count"), span: Span { start: 574, end: 579 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Assign, span: Span { start: 580, end: 582 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("count"), span: Span { start: 583, end: 588 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: BinarySelector("+"), span: Span { start: 589, end: 590 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Integer("1"), span: Span { start: 591, end: 592 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: RightBracket, span: Span { start: 592, end: 593 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 593, end: 594 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Integer("10"), span: Span { start: 599, end: 601 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [Whitespace(" ")] }
Token { kind: Keyword("timesRepeat:"), span: Span { start: 602, end: 614 }, leading_trivia: [], trailing_trivia: [Whitespace(" ")] }
Token { kind: Identifier("myBlock"), span: Span { start: 615, end: 622 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 622, end: 623 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Caret, span: Span { start: 628, end: 629 }, leading_trivia: [Whitespace("\n    ")], trailing_trivia: [] }
Token { kind: Identifier("count"), span: Span { start: 629, end: 634 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Period, span: Span { start: 634, end: 635 }, leading_trivia: [], trailing_trivia: [] }
Token { kind: Eof, span: Span { start: 636, end: 636 }, leading_trivia: [Whitespace("\n")], trailing_trivia: [] }
