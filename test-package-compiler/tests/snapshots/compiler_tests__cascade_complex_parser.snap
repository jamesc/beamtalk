---
source: test-package-compiler/tests/compiler_tests.rs
expression: output
---
AST:
Module {
    classes: [],
    method_definitions: [],
    expressions: [
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Copyright 2026 James Casey",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "SPDX-License-Identifier: Apache-2.0",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Test complex cascade scenarios",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                    Comment {
                        content: "Multiple cascaded messages with different types",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                        kind: Line,
                        preceding_blank_line: false,
                    },
                    Comment {
                        content: "Cascade with unary, binary, and keyword messages",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: Assignment {
                target: Identifier(
                    Identifier {
                        name: "counter",
                        span: Span {
                            start: 208,
                            end: 215,
                        },
                    },
                ),
                value: MessageSend {
                    receiver: ClassReference {
                        name: Identifier {
                            name: "Counter",
                            span: Span {
                                start: 219,
                                end: 226,
                            },
                        },
                        span: Span {
                            start: 219,
                            end: 226,
                        },
                    },
                    selector: Unary(
                        "new",
                    ),
                    arguments: [],
                    is_cast: false,
                    span: Span {
                        start: 219,
                        end: 230,
                    },
                },
                span: Span {
                    start: 208,
                    end: 230,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Identifier(
                Identifier {
                    name: "counter",
                    span: Span {
                        start: 231,
                        end: 238,
                    },
                },
            ),
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Cascade {
                receiver: Identifier(
                    Identifier {
                        name: "increment",
                        span: Span {
                            start: 244,
                            end: 253,
                        },
                    },
                ),
                messages: [
                    CascadeMessage {
                        selector: Unary(
                            "increment",
                        ),
                        arguments: [],
                        span: Span {
                            start: 259,
                            end: 268,
                        },
                    },
                    CascadeMessage {
                        selector: Unary(
                            "getValue",
                        ),
                        arguments: [],
                        span: Span {
                            start: 274,
                            end: 282,
                        },
                    },
                ],
                span: Span {
                    start: 244,
                    end: 282,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [
                    Comment {
                        content: "Cascade with keyword messages",
                        span: Span {
                            start: 317,
                            end: 323,
                        },
                        kind: Line,
                        preceding_blank_line: true,
                    },
                ],
                trailing: None,
            },
            expression: Identifier(
                Identifier {
                    name: "object",
                    span: Span {
                        start: 317,
                        end: 323,
                    },
                },
            ),
            preceding_blank_line: true,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found at:",
                span: Span {
                    start: 328,
                    end: 331,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found ;",
                span: Span {
                    start: 350,
                    end: 351,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found ;",
                span: Span {
                    start: 378,
                    end: 379,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found ;",
                span: Span {
                    start: 495,
                    end: 496,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found ;",
                span: Span {
                    start: 507,
                    end: 508,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Error {
                message: "Unexpected token: expected expression, found )",
                span: Span {
                    start: 517,
                    end: 518,
                },
            },
            preceding_blank_line: false,
        },
        ExpressionStatement {
            comments: CommentAttachment {
                leading: [],
                trailing: None,
            },
            expression: Cascade {
                receiver: Error {
                    message: "Unexpected token: expected expression, found ]",
                    span: Span {
                        start: 574,
                        end: 575,
                    },
                },
                messages: [
                    CascadeMessage {
                        selector: Keyword(
                            [
                                KeywordPart {
                                    keyword: "with:",
                                    span: Span {
                                        start: 581,
                                        end: 586,
                                    },
                                },
                            ],
                        ),
                        arguments: [
                            Block(
                                Block {
                                    parameters: [
                                        BlockParameter {
                                            name: "x",
                                            span: Span {
                                                start: 589,
                                                end: 590,
                                            },
                                        },
                                    ],
                                    body: [
                                        ExpressionStatement {
                                            comments: CommentAttachment {
                                                leading: [],
                                                trailing: None,
                                            },
                                            expression: MessageSend {
                                                receiver: Identifier(
                                                    Identifier {
                                                        name: "x",
                                                        span: Span {
                                                            start: 593,
                                                            end: 594,
                                                        },
                                                    },
                                                ),
                                                selector: Binary(
                                                    "*",
                                                ),
                                                arguments: [
                                                    Literal(
                                                        Integer(
                                                            2,
                                                        ),
                                                        Span {
                                                            start: 597,
                                                            end: 598,
                                                        },
                                                    ),
                                                ],
                                                is_cast: false,
                                                span: Span {
                                                    start: 593,
                                                    end: 598,
                                                },
                                            },
                                            preceding_blank_line: false,
                                        },
                                    ],
                                    span: Span {
                                        start: 587,
                                        end: 599,
                                    },
                                },
                            ),
                        ],
                        span: Span {
                            start: 581,
                            end: 599,
                        },
                    },
                    CascadeMessage {
                        selector: Unary(
                            "execute",
                        ),
                        arguments: [],
                        span: Span {
                            start: 605,
                            end: 612,
                        },
                    },
                ],
                span: Span {
                    start: 574,
                    end: 612,
                },
            },
            preceding_blank_line: false,
        },
    ],
    span: Span {
        start: 208,
        end: 612,
    },
    file_leading_comments: [],
    file_trailing_comments: [],
}

Diagnostics:
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found at:", span: Span { start: 328, end: 331 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ;", span: Span { start: 350, end: 351 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ;", span: Span { start: 378, end: 379 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ;", span: Span { start: 495, end: 496 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ;", span: Span { start: 507, end: 508 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found )", span: Span { start: 517, end: 518 }, hint: None, category: None }
Diagnostic { severity: Error, message: "Unexpected token: expected expression, found ]", span: Span { start: 574, end: 575 }, hint: None, category: None }
