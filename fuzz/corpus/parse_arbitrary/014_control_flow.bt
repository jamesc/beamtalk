// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for control flow constructs
//
// NOTE: Control flow with state mutation (whileTrue:, timesRepeat:, etc.)
// requires block-local variable mutation support (BT-90).
// Currently, assignments inside blocks don't propagate to outer scope.
// See variable_persistence.bt for tests of REPL-level variable persistence.

// ===========================================================================
// BLOCK EVALUATION (basic)
// ===========================================================================

// Block that returns a value
[5 + 3] value
// => 8

// Block with argument that returns computed value
[:x | x * 2] value: 7
// => 14

// Block with two arguments
[:a :b | a + b] value: 10 value: 20
// => 30

// ===========================================================================
// BLOCK EVALUATION (nested)
// ===========================================================================

// Nested block evaluation
[[:x | x * 3] value: 4] value
// => 12

// Block returning a block, then evaluating it
[[100]] value value
// => 100

// ===========================================================================
// BLOCK WITH CONDITIONALS
// ===========================================================================

// Block with comparison (returns boolean for conditional use)
[:x | x > 5] value: 10
// => true

[:x | x > 5] value: 3
// => false

// Block with arithmetic comparison
[:x :y | x + y > 10] value: 5 value: 10
// => true

// ===========================================================================
// VARIABLE PERSISTENCE IN REPL
// ===========================================================================
// Note: Variables persist across expressions within the same test file.
// Assignments inside blocks DON'T propagate back (requires BT-90).

// Set up a value
baseValue := 100
// => 100

// Use it in a block
[:x | x + baseValue] value: 50
// => 150

// Value still accessible
baseValue
// => 100

