// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

/// TranscriptStream â€” Per-workspace shared log with pub/sub semantics.
///
/// TranscriptStream is a real actor (gen_server) that acts as a shared
/// log within a workspace. Each workspace has its own Transcript instance.
/// Subscribers receive output in real-time; unsubscribed output goes to
/// buffer only. Analogous to Smalltalk's `Transcript` global.
///
/// ## Examples
/// ```beamtalk
/// Transcript show: "hello"
/// Transcript cr
/// Transcript recent
/// ```
Actor subclass: TranscriptStream
  classState: current = nil

  /// Return the current singleton instance (nil before workspace bootstrap).
  class current -> TranscriptStream => self.current

  /// Set the current singleton instance.
  class current: instance: TranscriptStream -> Nil => self.current := instance

  /// Clear the current singleton instance (reset to nil).
  class resetCurrent -> Nil => self.current := nil

  /// Write a value to the transcript.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript show: "hello"
  /// Transcript show: 42
  /// ```
  show: value: Object -> Nil => @primitive "show:"

  /// Write a newline to the transcript.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript cr
  /// ```
  cr -> Nil => @primitive "cr"

  /// Subscribe the calling process to receive transcript output.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript subscribe
  /// ```
  subscribe -> Nil => @primitive "subscribe"

  /// Unsubscribe the calling process from transcript output.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript unsubscribe
  /// ```
  unsubscribe -> Nil => @primitive "unsubscribe"

  /// Return recent transcript entries as a list.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript recent
  /// ```
  recent -> List => @primitive "recent"

  /// Clear the transcript buffer.
  ///
  /// ## Examples
  /// ```beamtalk
  /// Transcript clear
  /// ```
  clear -> Nil => @primitive "clear"
