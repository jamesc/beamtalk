// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for Set (unique element collections using ordsets) (BT-73)

TestCase subclass: SetTest

  testCreationClass =>
    Set new.
    self assert: ((Set new) class) equals: Set

  testIsemptySize =>
    self assert: ((Set new) isEmpty).
    self assert: ((Set new) size) equals: 0

  testAddIncludes =>
    s := (Set new) add: 1.
    self assert: (s includes: 1).
    self deny: (s includes: 2).
    self assert: (s size) equals: 1

  testAddDeduplication =>
    s := (Set new) add: 1.
    s2 := (s add: 2) add: 1.
    self assert: (s2 size) equals: 2.
    self assert: (s2 includes: 1).
    self assert: (s2 includes: 2)

  testRemove =>
    s2 := ((Set new) add: 1) add: 2.
    s3 := s2 remove: 1.
    self deny: (s3 includes: 1).
    self assert: (s3 includes: 2).
    self assert: (s3 size) equals: 1

  testFromList =>
    colors := Set new fromList: #(#red, #green, #blue).
    self assert: (colors size) equals: 3.
    self assert: (colors includes: #red).
    self deny: (colors includes: #yellow)

  testUnion =>
    a := Set new fromList: #(1, 2, 3).
    b := Set new fromList: #(3, 4, 5).
    u := a union: b.
    self assert: (u size) equals: 5.
    self assert: (u includes: 1).
    self assert: (u includes: 5)

  testIntersection =>
    a := Set new fromList: #(1, 2, 3).
    b := Set new fromList: #(3, 4, 5).
    i := a intersection: b.
    self assert: (i size) equals: 1.
    self assert: (i includes: 3).
    self deny: (i includes: 1)

  testDifference =>
    a := Set new fromList: #(1, 2, 3).
    b := Set new fromList: #(3, 4, 5).
    d := a difference: b.
    self assert: (d size) equals: 2.
    self assert: (d includes: 1).
    self deny: (d includes: 3)

  testIssubsetof =>
    small := Set new fromList: #(1, 2).
    big := Set new fromList: #(1, 2, 3).
    self assert: (small isSubsetOf: big).
    self deny: (big isSubsetOf: small)

  testAslist =>
    self assert: (((Set new) fromList: #(3, 1, 2)) asList) equals: #(1, 2, 3)

  testIteration =>
    self assert: (((Set new) fromList: #(1, 2, 3)) do: [:x | nil]) equals: nil.
    // Block receives each element â€” inject:into: verifies correct values are passed
    self assert: (((Set new) fromList: #(1, 2, 3)) inject: 0 into: [:sum :x | sum + x]) equals: 6

  testRespondstoMethodReflection =>
    s4 := (Set new) add: 1.
    self assert: (s4 respondsTo: #size).
    self assert: (s4 respondsTo: #includes:).
    self deny: (s4 respondsTo: #nonExistent)

  testPrintstring =>
    self assert: (((Set new) fromList: #(1, 2, 3)) printString) notNil.
    self assert: ((Set new) printString) notNil
