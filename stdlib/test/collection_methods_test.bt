// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for List collection methods (BT-408)

TestCase subclass: CollectionMethodsTest

  testCollectMap =>
    self assert: (#(1, 2, 3) collect: [:x | x * 2]) equals: #(2, 4, 6).
    // collect: on empty list
    self assert: (#() collect: [:x | x * 2]) equals: #()

  testSelectFilter =>
    // select: elements greater than 2
    self assert: (#(1, 2, 3, 4, 5) select: [:x | x > 2]) equals: #(3, 4, 5).
    // select: even numbers
    self assert: (#(1, 2, 3, 4, 5, 6) select: [:x | x isEven]) equals: #(2, 4, 6).
    // select: no matches
    self assert: (#(1, 2, 3) select: [:x | x > 10]) equals: #()

  testRejectInverseFilter =>
    // reject: elements greater than 2
    self assert: (#(1, 2, 3, 4, 5) reject: [:x | x > 2]) equals: #(1, 2).
    // reject: even numbers
    self assert: (#(1, 2, 3, 4, 5, 6) reject: [:x | x isEven]) equals: #(1, 3, 5)

  testInjectIntoFoldReduce =>
    // inject:into: sum
    self assert: (#(1, 2, 3, 4, 5) inject: 0 into: [:sum :x | sum + x]) equals: 15.
    // inject:into: product
    self assert: (#(1, 2, 3, 4) inject: 1 into: [:product :x | product * x]) equals: 24.
    // inject:into: on single element
    self assert: (#(42) inject: 0 into: [:acc :x | acc + x]) equals: 42.
    // inject:into: non-commutative — verifies (acc, elem) argument order
    self assert: (#("b", "c") inject: "a" into: [:acc :x | acc ++ x]) equals: "abc".
    // inject:into: non-commutative — list prepend reverses
    self assert: (#(1, 2, 3) inject: #() into: [:acc :x | acc addFirst: x]) equals: #(3, 2, 1)

  testDoIteration =>
    // do: returns ok (side-effect only)
    self assert: (#(1, 2, 3) do: [:x | x + 1]) equals: #ok
