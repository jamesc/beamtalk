// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-598: Test fixture for local variable mutation in actor method blocks
// Actor with methods that mutate local variables in various control flow constructs

Actor subclass: LocalMutationActor
  state: log = 0

  getLog => self.log

  // Local mutation in do: (lists:foldl path)
  sumWithDo: items =>
    total := 0
    items do: [:item |
      total := total + item
    ]
    total

  // Local mutation in inject:into:
  sumWithInject: items =>
    count := 0
    result := items inject: 0 into: [:acc :item |
      count := count + 1
      acc + item
    ]
    #{#result => result, #count => count}

  // Local mutation in timesRepeat:
  countToN: n =>
    counter := 0
    n timesRepeat: [
      counter := counter + 1
    ]
    counter

  // Local mutation in to:do:
  sumRange: n =>
    total := 0
    1 to: n do: [:i |
      total := total + i
    ]
    total

  // Local mutation in whileTrue:
  countDownFrom: n =>
    counter := n
    steps := 0
    [counter > 0] whileTrue: [
      counter := counter - 1
      steps := steps + 1
    ]
    steps

  // Local mutation in whileFalse:
  countUpWithWhileFalseFrom: n =>
    counter := 0
    [counter >= n] whileFalse: [
      counter := counter + 1
    ]
    counter

  // Local mutation in to:by:do:
  sumEvens: n =>
    total := 0
    2 to: n by: 2 do: [:i |
      total := total + i
    ]
    total

  // Mixed local + field mutation
  processWithTracking: items =>
    localCount := 0
    items do: [:item |
      localCount := localCount + 1
      self.log := self.log + item
    ]
    #{#localCount => localCount, #log => self.log}
