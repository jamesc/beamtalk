// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// E2E tests for sealed class codegen optimization (BT-403)


TestCase subclass: SealedClassTest

  testSection1 =>
    c := SealedCounter spawn.
    // Basic read: getValue (uses __sealed_getValue direct call internally)
    self assert: (c getValue await) equals: 0.
    // Mutation via external call: increment
    self assert: (c increment await) equals: 1.
    // Verify state persisted after increment
    self assert: (c getValue await) equals: 1.
    // Second increment
    self assert: (c increment await) equals: 2.
    // Decrement
    self assert: (c decrement await) equals: 1.
    // Parentheses needed: unary messages bind tighter than keyword messages
    self assert: ((c addAmount: 10) await) equals: 11.
    // Internal self-send: getValuePlusTen calls self getValue (tests __sealed_* direct call)
    self assert: (c getValuePlusTen await) equals: 21.
    // Final state verification
    self assert: (c getValue await) equals: 11
