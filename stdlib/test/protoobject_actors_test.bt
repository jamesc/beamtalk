// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Tests for ProtoObject with actors - identity and inheritance

// @load stdlib/test/fixtures/counter.bt

TestCase subclass: ProtoobjectActorsTest

  testActorIdentityTests =>
    a := Counter spawn.
    b := a.
    c := Counter spawn.
    // Same reference
    self assert: (a == b).
    // Different processes
    self deny: (a == c).
    self assert: (a /= c)

  testInheritanceTests =>
    // Actor class has superclass
    self assert: (Counter superclass) equals: Actor.
    // Root class has no superclass
    self assert: (ProtoObject superclass) equals: nil

  testActorBasicMessagingWithAwait =>
    counter := Counter spawn.
    // Test initial state
    self assert: (counter getValue await) equals: 0.
    // Test increment
    self assert: (counter increment await) equals: 1.
    // Verify state persisted
    self assert: (counter getValue await) equals: 1.
    // Test multiple increments
    self assert: (counter increment await) equals: 2.
    self assert: (counter increment await) equals: 3.
    // Test decrement
    self assert: (counter decrement await) equals: 2.
    // Final state verification
    self assert: (counter getValue await) equals: 2

  testBt427ObjectMethodDelegationForActors =>
    counter := Counter spawn.
    // isNil and notNil — nil-testing protocol from Object (intrinsic, no await)
    self deny: (counter isNil).
    // Actors inherit Object base methods via the class hierarchy walk.
    self assert: (counter notNil).
    // respondsTo: — checks both user methods and inherited methods
    self assert: (counter respondsTo: #increment).
    self assert: (counter respondsTo: #getValue).
    self assert: (counter respondsTo: #decrement).
    self deny: (counter respondsTo: #nonExistent).
    // class — returns class name from Object
    self assert: (counter class) equals: Counter
