// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-598: Tests that local variables inside actor method blocks are correctly
// mutated and scoped â€” covering do:, inject:into:, to:do:, and whileFalse:.


TestCase subclass: ActorLocalMutationsTest

  testLocalMutationsInActorBlocks =>
    a := LocalMutationActor spawn.
    self assert: ((a sumWithDo: #(1, 2, 3, 4, 5))) equals: 15.
    b := LocalMutationActor spawn.
    self assert: ((b sumWithInject: #(10, 20, 30))) equals: #{#count => 3, #result => 60}.
    c := LocalMutationActor spawn.
    self assert: (c countToN: 5) equals: 5.
    d := LocalMutationActor spawn.
    self assert: (d sumRange: 5) equals: 15.
    e := LocalMutationActor spawn.
    self assert: (e countDownFrom: 3) equals: 3.
    h := LocalMutationActor spawn.
    self assert: (h countUpWithWhileFalseFrom: 3) equals: 3.
    i := LocalMutationActor spawn.
    self assert: (i sumEvens: 10) equals: 30.
    f := LocalMutationActor spawn.
    self assert: ((f processWithTracking: #(5, 10, 15))) equals: #{#localCount => 3, #log => 30}.
    g := FieldMutationAccumulator spawn.
    self assert: ((g processWithLocal: #(10, 20, 30))) equals: #{#localSum => 3, #sum => 60}
