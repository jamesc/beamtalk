// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-598: Test local variable mutation in actor method blocks


TestCase subclass: ActorLocalMutationsTest

  testSection1 =>
    a := LocalMutationActor spawn.
    self assert: ((a sumWithDo: #(1, 2, 3, 4, 5)) await) equals: 15.
    b := LocalMutationActor spawn.
    self assert: ((b sumWithInject: #(10, 20, 30)) await) equals: #{#count => 3, #result => 60}.
    c := LocalMutationActor spawn.
    self assert: ((c countToN: 5) await) equals: 5.
    d := LocalMutationActor spawn.
    self assert: ((d sumRange: 5) await) equals: 15.
    e := LocalMutationActor spawn.
    self assert: ((e countDownFrom: 3) await) equals: 3.
    h := LocalMutationActor spawn.
    self assert: ((h countUpWithWhileFalseFrom: 3) await) equals: 3.
    i := LocalMutationActor spawn.
    self assert: ((i sumEvens: 10) await) equals: 30.
    f := LocalMutationActor spawn.
    self assert: ((f processWithTracking: #(5, 10, 15)) await) equals: #{#localCount => 3, #log => 30}.
    g := FieldMutationAccumulator spawn.
    self assert: ((g processWithLocal: #(10, 20, 30)) await) equals: #{#localSum => 3, #sum => 60}
