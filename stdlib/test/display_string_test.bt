// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BT-929: Tests for displayString / printString two-protocol distinction
// printString  = developer representation (unambiguous, quoted strings, #symbol)
// displayString = user-facing representation (no quotes, no # prefix)

TestCase subclass: DisplayStringTest

  testStringPrintString =>
    // printString adds surrounding quotes for developer inspection
    self assert: "hello" printString equals: """hello"""

  testStringDisplayString =>
    // displayString returns the raw string (no quotes)
    self assert: "hello" displayString equals: "hello"

  testStringPrintStringIsDifferentFromDisplayString =>
    // The two should differ for strings (printString adds quotes)
    self deny: ("hello" printString =:= "hello" displayString)

  testEmptyStringPrintString =>
    self assert: "" printString equals: """"""

  testEmptyStringDisplayString =>
    self assert: "" displayString equals: ""

  testSymbolPrintString =>
    // printString includes the # prefix
    self assert: #hello printString equals: "#hello"

  testSymbolDisplayString =>
    // displayString omits the # prefix
    self assert: #hello displayString equals: "hello"

  testSymbolPrintStringIsDifferentFromDisplayString =>
    // The two should differ for symbols
    self deny: (#hello printString =:= #hello displayString)

  testIntegerDisplayString =>
    // Integer inherits displayString from Object, delegates to printString
    self assert: 42 displayString equals: "42"

  testIntegerDisplayStringNegative =>
    self assert: -7 displayString equals: "-7"

  testObjectDisplayStringDelegatesToPrintString =>
    // Object.displayString delegates to printString by default
    self assert: 42 displayString equals: 42 printString

  // BT-933: printString must escape embedded double-quote characters by doubling them

  testStringWithEmbeddedQuotePrintString =>
    // "a""b" is the string a"b; printString doubles the embedded " and wraps in outer quotes
    // Result is "a""b" (6 chars), written as Beamtalk literal: """a""""b"""
    self assert: "a""b" printString equals: """a""""b"""

  testStringThatIsJustAQuotePrintString =>
    // """" is the string containing one "; printString produces """" (4 chars: " "" ")
    // That 4-char string as a Beamtalk literal is: """"""""""
    self assert: """" printString equals: """"""""""

  testStringWithMultipleEmbeddedQuotesPrintString =>
    // "a""b""c" is the string a"b"c; printString doubles each " and wraps
    // Result: "a""b""c" (8 chars), as Beamtalk: """a""""b""""c"""
    self assert: "a""b""c" printString equals: """a""""b""""c"""
