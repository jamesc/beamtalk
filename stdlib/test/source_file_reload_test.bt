// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Tests for Behaviour >> sourceFile and Behaviour >> reload (BT-845, ADR 0040 Phase 2).
//
// Verifies:
// - sourceFile returns nil for stdlib classes (never loaded from a user file)
// - reload raises no_source_file for stdlib classes
// - sourceFile is a sealed method on all classes (isBehaviour check)
//
// The positive case (sourceFile returns a path after :load) requires the REPL
// context and is tested in tests/e2e/cases/source_file_reload.bt.

TestCase subclass: SourceFileReloadTest

  testStdlibClassSourceFileIsNil =>
    // Stdlib classes have no user-supplied source file
    self assert: Integer sourceFile isNil.
    // => _
    self assert: String sourceFile isNil.
    // => _
    self assert: Object sourceFile isNil.
    // => _
    self assert: Boolean sourceFile isNil.
    // => _
    self assert: Actor sourceFile isNil
    // => _

  testBootstrapBehaviourSourceFileIsNil =>
    // Behaviour itself is a stdlib class â€” no source file
    self assert: Behaviour sourceFile isNil
    // => _

  testStdlibReloadRaisesNoSourceFile =>
    // Reloading a stdlib class raises no_source_file
    self should: [Integer reload] raise: #no_source_file.
    // => _
    self should: [String reload] raise: #no_source_file.
    // => _
    self should: [Object reload] raise: #no_source_file
    // => _

  testSourceFileMethodExists =>
    // sourceFile is a sealed method defined in Behaviour (class protocol)
    self assert: (Behaviour includesSelector: #sourceFile).
    // => _
    // Sending sourceFile to any class object returns nil or a path (no DNU)
    self assert: Integer sourceFile isNil
    // => _

  testReloadMethodExists =>
    // reload is a sealed method defined in Behaviour (class protocol)
    self assert: (Behaviour includesSelector: #reload).
    // => _
    // Reloading a stdlib class (Behaviour itself) raises no_source_file
    self should: [Behaviour reload] raise: #no_source_file
    // => _
