// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// BUnit tests for runtime-embedded documentation (ADR 0033, BT-769)


TestCase subclass: RuntimeDocTest

  // --- Class doc ---

  testClassDocDefaultsToNil =>
    self assert: DocTestHelper doc equals: nil

  testSetClassDoc =>
    DocTestHelper doc: "A helper for testing".
    self assert: DocTestHelper doc equals: "A helper for testing"

  testSetClassDocOverwrites =>
    DocTestHelper doc: "First doc".
    DocTestHelper doc: "Second doc".
    self assert: DocTestHelper doc equals: "Second doc"

  // --- Method doc via >> and doc message ---

  testMethodDocDefaultsToNil =>
    m := DocTestHelper >> #greet.
    self assert: m doc equals: nil

  testSetMethodDoc =>
    DocTestHelper setDocForMethod: #greet to: "Say hello".
    m := DocTestHelper >> #greet.
    self assert: m doc equals: "Say hello"

  testSetMethodDocDifferentMethods =>
    DocTestHelper setDocForMethod: #answer to: "Return 42".
    m := DocTestHelper >> #answer.
    self assert: m doc equals: "Return 42"

  // --- CompiledMethod doc accessor ---

  testCompiledMethodDocField =>
    DocTestHelper setDocForMethod: #greet to: "Greeting method".
    m := DocTestHelper >> #greet.
    self assert: m doc equals: "Greeting method".
    self assert: m selector equals: #greet

  // --- doc: returns self (chainable) ---

  testDocSetterReturnsSelf =>
    result := DocTestHelper doc: "Chainable".
    self assert: result equals: DocTestHelper
