// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Tests for variable scope and resolution


TestCase subclass: SemanticScopeTest

  testSection1 =>
    self assert: ([:x | x + 1] value: 5) equals: 6.
    // Nested block parameters work correctly
    self assert: ([:x | [:y | x + y] value: 3] value: 10) equals: 13.
    // Variables defined in one expression are accessible in later ones
    scopeTestVar := 100.
    self assert: scopeTestVar equals: 100.
    // --- Variable scoping across expressions ---
    self assert: (scopeTestVar + 50) equals: 150.
    // Variables can be reassigned
    scopeTestVar := 200.
    self assert: scopeTestVar equals: 200.
    self assert: scopeTestVar equals: 200.
    // Closures capture outer variables
    outerVal := 10.
    self assert: outerVal equals: 10.
    // --- Closure variable capture ---
    adder := [:x | x + outerVal].
    self assert: (adder value: 5) equals: 15.
    // self is valid in method bodies â€” actor methods use self.field
    c := Counter spawn.
    // --- Self reference in class methods ---
    self assert: (c increment await) equals: 1.
    self assert: (c increment await) equals: 2.
    self assert: (c getValue await) equals: 2
