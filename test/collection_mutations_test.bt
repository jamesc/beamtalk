// Copyright 2026 James Casey
// SPDX-License-Identifier: Apache-2.0

// Tests for is_list guard in mutation-threading codegen paths (BT-524)

// @load tests/e2e/fixtures/collection_mutation_counter.bt

TestCase subclass: CollectionMutationsTest

  testSection1 =>
    counter := CollectionMutationCounter spawn.
    self assert: (counter getTotal await) equals: 0.
    self assert: ((counter sumSet: #(1, 2, 3)) await) equals: 6.
    self assert: (counter getTotal await) equals: 6.
    counter2 := CollectionMutationCounter spawn.
    s := (Set new) fromList: #(1, 2, 3).
    self assert: ((counter2 sumSet: s) await) equals: 6.
    self assert: (counter2 getTotal await) equals: 6.
    counter3 := CollectionMutationCounter spawn.
    self assert: ((counter3 sumDictValues: (Dictionary new: #{#a => 10, #b => 20, #c => 30})) await) equals: 60.
    self assert: (counter3 getTotal await) equals: 60
